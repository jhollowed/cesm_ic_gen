module cam_grid

!=======================================================================
! physical constants
!=======================================================================
  use cam_physical_constants

  implicit none
  
!=======================================================================
!     choice of the model grid: Gaussian or lat-lon grid including the poles
!            and test case
!=======================================================================
      integer :: model_version,      &   ! CAM, 1: Eul/SLD (Gaussian), 2: FV (lat-lon)
                 choice_testcase                 ! test case number

!======================================================================
!     output/input character strings
!=======================================================================
      character tc_name*2, &                     ! name of the test case
                tc_nr*3, &                       ! test case number as character string
                model*6,  &                      ! model name
                resol*3,  &                      ! 
                correct*1
      character c_level*2                        ! number of vertical levels
      character c_alpha*1                        ! rotation angle alpha
      character cnx*4, cny*4                     ! FV resolution

!=======================================================================
!     horizontal grid and total number of grid points:
!=======================================================================
      integer :: nlon,                         & ! number of longitudes
                 nlat,                         & ! number of latitudes
                 nslat,                        & ! number of staggered latitudes (FV dycore)
                 nlayer,                       & ! number of grid points per level
                 nslayer,                      & ! number of grid points (staggered) per level
                 ntotal,                       & ! number of total grid points
                 nstotal                         ! number of total grid points (staggered)

!=======================================================================
!     vertical grid
!     hbrid coefficients for the vertical levels, standard CAM3.1 has 26 levels
!     alternative: 44 levels
!=======================================================================
      integer :: nlev                            ! number of vertical levels
      integer, parameter :: nlev_L20 = 20,     & ! 20 pre-set levels with 500 m spacing
                            nlev_L26 = 26,     & ! 26 pre-set levels
                            nlev_L30 = 30,     & ! 30 pre-set levels
                            nlev_L44 = 44,     & ! 44 pre-set levels
                            nlev_L52 = 52,     & ! 52 pre-set levels, CAM4 halved
                            nlev_L55 = 55,     & ! 55 pre-set levels, 1.25 km grid spacing
                            nlev_L60 = 60,     & ! 60 pre-set levels, 200 m grid spacing
                            nlev_L67 = 67        ! 67 pre-set levels, 900 m grid spacing
      
      real(r8) :: dz                             ! equidistant spacing for some test cases
      
      real(r8) :: hyai_L20(nlev_L20+1),       &  ! coefficient a, 21 interface levels
                  hybi_L20(nlev_L20+1),       &  ! coefficient a, 21 interface levels
                  hyai_L26(nlev_L26+1),       &  ! coefficient a, 27 interface levels
                  hybi_L26(nlev_L26+1),       &  ! coefficient a, 27 interface levels
                  hyai_L30(nlev_L30+1),       &  ! coefficient a, 27 interface levels
                  hybi_L30(nlev_L30+1),       &  ! coefficient a, 27 interface levels
                  hyai_L44(nlev_L44+1),       &  ! coefficient a, 45 interface levels
                  hybi_L44(nlev_L44+1),       &  ! coefficient a, 45 interface levels
                  hyai_L52(nlev_L52+1),       &  ! coefficient a, 53 interface levels
                  hybi_L52(nlev_L52+1),       &  ! coefficient a, 53 interface levels
                  hyai_L55(nlev_L55+1),       &  ! coefficient a, 56 interface levels
                  hybi_L55(nlev_L55+1),       &  ! coefficient a, 56 interface levels
                  hyai_L60(nlev_L60+1),       &  ! coefficient a, 61 interface levels
                  hybi_L60(nlev_L60+1),       &  ! coefficient a, 61 interface levels
                  hyai_L60_adv(nlev_L60+1),   &  ! coefficient a, 61 interface levels, advection test with dz=250m
                  hybi_L60_adv(nlev_L60+1),   &  ! coefficient a, 61 interface levels, advection test with dz=250m
                  hyai_L67(nlev_L67+1),       &  ! coefficient a, 68 interface levels
                  hybi_L67(nlev_L67+1)           ! coefficient a, 68 interface levels
                  
!===================================
!     vertical hybrid coefficients
!===================================
      data hyai_L20 /                                                  &
      0.27381905404907E+00,  0.26590539035976E+00,  0.25752394878279E+00, 0.24865429808716E+00,& 
      0.23927536347865E+00,  0.22936541085572E+00,  0.21890203071294E+00, 0.20786212168493E+00,& 
      0.19622187372385E+00,  0.18395675090318E+00,  0.17104147384052E+00, 0.15745000173179E+00,& 
      0.14315551398919E+00,  0.12813039147516E+00,  0.11234619732416E+00, 0.95773657344247E-01,& 
      0.78382639990006E-01,  0.60142135898353E-01,  0.41020236978492E-01, 0.20984115047143E-01,& 
      0.00000000000000E+00/

      data  hybi_L20 /                                                 &
      0.00000000000000E+00,  0.28901070149364E-01,  0.59510487036309E-01, 0.91902866472543E-01,&
      0.12615517459290E+00,  0.16234678535331E+00,  0.20055953931639E+00, 0.24087780374962E+00,& 
      0.28338853406205E+00,  0.32818133660555E+00,  0.37534853286773E+00, 0.42498522508382E+00,& 
      0.47718936329560E+00,  0.53206181388604E+00,  0.58970642961892E+00, 0.65023012121324E+00,& 
      0.71374293048299E+00,  0.78035810507338E+00,  0.85019217482527E+00, 0.92336502980036E+00,& 
      0.10000000000000E+01/

!=======================================================================
!     Initialization of the default hybrid coefficients for 26 full levels
!     the hybrid coefficients of the 27 interface level are listed
!     the coefficients of the full levels are computed via 0.5(hyai(i)+hyai(i+1))
!=======================================================================
      data hyai_L26 /                                                  &
       0.002194067, 0.004895209, 0.009882418,                          &
       0.01805201, 0.02983724, 0.04462334, 0.06160587,                 &
       0.07851243, 0.07731271, 0.07590131,                             &
       0.07424086, 0.07228744, 0.06998933,                             &
       0.06728574, 0.06410509, 0.06036322, 0.05596111,                 &
       0.05078225, 0.04468960, 0.03752191,                             &
       0.02908949, 0.02084739, 0.01334443, 0.00708499,                 & 
       0.00252136, 0., 0. /

      data  hybi_L26 /                                                 &
       0., 0., 0., 0., 0., 0., 0., 0., 0.01505309, 0.03276228,         &
       0.05359622, 0.07810627, 0.1069411, 0.1408637, 0.180772,         &
       0.2277220, 0.2829562, 0.3479364, 0.4243822,                     &
       0.5143168, 0.6201202, 0.7235355,                                &
       0.8176768, 0.8962153, 0.9534761,                                &
       0.9851122, 1. /


      data hyai_L30 /                                                  &
       2.25523952394723892E-003,         &
  5.03169186413288116E-003, &
  1.01579474285244942E-002, &
  1.85553170740604401E-002, &
  3.06691229343414307E-002, &
  4.58674766123294830E-002, &
  6.33234828710556030E-002, &
  8.07014182209968567E-002, &
  9.49410423636436462E-002, &
  0.11169321089982986, &
  0.13140127062797546, & 
  0.15458680689334869, &
  0.18186335265636444, &
  0.17459799349308014, & 
  0.16605065762996674, &
  0.15599516034126282, &
  0.14416541159152985, &
  0.13024830818176270, &
  0.11387556791305542, &
  9.46138575673103333E-002, &
  7.53444507718086243E-002, &
  5.76589405536651611E-002, &
  4.27346378564834595E-002, &
  3.16426791250705719E-002, &
  2.52212174236774445E-002, &
  1.91967375576496124E-002, &
  1.36180268600583076E-002, &
  8.53108894079923630E-003, &
  3.97881818935275078E-003, &
   0.0000000000000000, &
   0.0000000000000000 /

      data hybi_L30 /      &
       0.0000000000000000, &
   0.0000000000000000, &
   0.0000000000000000, &
   0.0000000000000000, &
   0.0000000000000000, &
   0.0000000000000000, &
   0.0000000000000000, &
   0.0000000000000000, &
   0.0000000000000000, &
   0.0000000000000000, &
   0.0000000000000000, &
   0.0000000000000000, &
   0.0000000000000000, &
  3.93548272550106049E-002, &
  8.56537595391273499E-002, &
  0.14012205600738525, &
  0.20420117676258087, &
  0.27958691120147705, &
  0.36827436089515686, &
  0.47261056303977966, &
  0.57698851823806763, &
  0.67278695106506348, &
  0.75362843275070190, &
  0.81371098756790161, &
  0.84849464893341064, &
  0.88112789392471313, & 
  0.91134643554687500, &
  0.93890124559402466, &
  0.96355980634689331, &
  0.98511219024658203, &
   1.0000000000000000 /


!=======================================================================
!     44 levels
!=======================================================================
      data hyai_L44 /   0.21589745E-02,  0.27800647E-02,                  &
       0.35013904E-02,  0.43556332E-02,  0.53965277E-02,  0.66861713E-02, &
       0.82840094E-02,  0.10263694E-01,  0.12716476E-01,  0.15755416E-01, &
       0.19520592E-01,  0.24185557E-01,  0.29965339E-01,  0.37126353E-01, &
       0.45998682E-01,  0.56991289E-01,  0.69983999E-01,  0.85074111E-01, &
       0.10181707E+00,  0.11883090E+00,  0.13442915E+00,  0.14736354E+00, &
       0.15689206E+00,  0.16266609E+00,  0.16465004E+00,  0.16297620E+00, &
       0.15791598E+00,  0.14985270E+00,  0.13925520E+00,  0.12665295E+00, &
       0.11261230E+00,  0.97714063E-01,  0.82532109E-01,  0.67613398E-01, &
       0.53459180E-01,  0.40507188E-01,  0.29115703E-01,  0.19548047E-01, &
       0.11958906E-01,  0.63814844E-02,  0.27162500E-02,  0.72062500E-03, &
       0.00000000E+00,  0.00000000E+00,  0.00000000E+00 /

      data hybi_L44 /   0.00000000E+00,  0.00000000E+00,                  &
       0.00000000E+00,  0.00000000E+00,  0.00000000E+00,  0.00000000E+00, &
       0.00000000E+00,  0.00000000E+00,  0.00000000E+00,  0.00000000E+00, &
       0.00000000E+00,  0.00000000E+00,  0.00000000E+00,  0.00000000E+00, &
       0.00000000E+00,  0.00000000E+00,  0.00000000E+00,  0.10036000E-03, &
       0.67271000E-03,  0.31633400E-02,  0.92923400E-02,  0.20319160E-01, &
       0.36974860E-01,  0.59487640E-01,  0.87894980E-01,  0.12200361E+00, &
       0.16144150E+00,  0.20570326E+00,  0.25418860E+00,  0.30623537E+00, &
       0.36114502E+00,  0.41820228E+00,  0.47668815E+00,  0.53588659E+00, &
       0.59508425E+00,  0.65356457E+00,  0.71059442E+00,  0.76540524E+00, &
       0.81716698E+00,  0.86495584E+00,  0.90771586E+00,  0.94421321E+00, &
       0.97298521E+00,  0.99228150E+00,  0.10000000E+01 /


!=======================================================================
!     52 levels
!=======================================================================
!=======================================================================
!     Initialization of the halved CAM4 hybrid coefficients for 52 full levels
!     the hybrid coefficients of the 53 interface level are listed
!     the coefficients of the full levels are computed via
!     0.5(hyai(i)+hyai(i+1))
!=======================================================================
      data hyai_L52 /                                                 &
0.21940669976175E-02,  0.35446379333735E-02,  0.48952088691294E-02, 0.73888136539608E-02,&
0.98824184387922E-02,  0.13967214152217E-01,  0.18052009865642E-01, 0.23944624699652E-01,&
0.29837239533663E-01,  0.37230290472507E-01,  0.44623341411352E-01, 0.53114606067538E-01,&
0.61605870723724E-01,  0.70059150457382E-01,  0.78512430191040E-01, 0.77912569046021E-01,&
0.77312707901001E-01,  0.76607007533312E-01,  0.75901307165623E-01, 0.75071085244417E-01,&
0.74240863323212E-01,  0.73264151811600E-01,  0.72287440299988E-01, 0.71138385683298E-01,&
0.69989331066608E-01,  0.68637534976006E-01,  0.67285738885403E-01, 0.65695416182280E-01,&
0.64105093479156E-01,  0.62234155833721E-01,  0.60363218188286E-01, 0.58162163943052E-01,&
0.55961109697819E-01,  0.53371679037809E-01,  0.50782248377800E-01, 0.47735923901200E-01,&
0.44689599424601E-01,  0.41105754673481E-01,  0.37521909922361E-01, 0.33305699937046E-01,&
0.29089489951730E-01,  0.24968439713120E-01,  0.20847389474511E-01, 0.17095909919590E-01,&
0.13344430364668E-01,  0.10214710142463E-01,  0.70849899202585E-02, 0.48031749902293E-02,&
0.25213600602001E-02,  0.12606800301000E-02,  0.00000000000000E+00, 0.00000000000000E+00,&
0.00000000000000E+00 / 

      data hybi_L52 /                                                 &
0.00000000000000E+00,  0.00000000000000E+00,  0.00000000000000E+00, 0.00000000000000E+00,&
0.00000000000000E+00,  0.00000000000000E+00,  0.00000000000000E+00, 0.00000000000000E+00,&
0.00000000000000E+00,  0.00000000000000E+00,  0.00000000000000E+00, 0.00000000000000E+00,&
0.00000000000000E+00,  0.00000000000000E+00,  0.00000000000000E+00, 0.75265448540449E-02,&
0.15053089708090E-01,  0.23907685652375E-01,  0.32762281596661E-01, 0.43179251253605E-01,&
0.53596220910549E-01,  0.65851245075464E-01,  0.78106269240379E-01, 0.92523682862520E-01,&
0.10694109648466E+00,  0.12390239909291E+00,  0.14086370170116E+00, 0.16081785410643E+00,&
0.18077200651169E+00,  0.20424700528383E+00,  0.22772200405598E+00, 0.25533910840750E+00,&
0.28295621275902E+00,  0.31544630229473E+00,  0.34793639183044E+00, 0.38615930080414E+00,&
0.42438220977783E+00,  0.46934950351715E+00,  0.51431679725647E+00, 0.56721851229668E+00,&
0.62012022733688E+00,  0.67182785272598E+00,  0.72353547811508E+00, 0.77060613036156E+00,&
0.81767678260803E+00,  0.85694605112076E+00,  0.89621531963348E+00, 0.92484569549561E+00,&
0.95347607135773E+00,  0.96929413080215E+00,  0.98511219024658E+00, 0.99255609512329E+00,&
0.10000000000000E+01 /

!=======================================================================
!     55 levels
!=======================================================================
      data hyai_L55 / &
    8.0401005e-05, 0.00011960172, 0.00017406703, 0.00024816737,               & 
    0.00034700267, 0.00047638666, 0.00064279727, 0.00085329212, 0.0011153902, &
    0.001436924, 0.0018258672, 0.0022901448, 0.0028374356, 0.0035155157,      &
    0.0043556411, 0.0053965361, 0.0066861813, 0.0082840202, 0.010263706,      &
    0.01271649, 0.01575543, 0.019520607, 0.024185572, 0.029965352,            &
    0.037126362, 0.045998689, 0.05699129, 0.069983996, 0.085174471,           &
    0.10248978, 0.12199424, 0.13442916, 0.14736354, 0.15689206, 0.1626661,    &
    0.16465004, 0.16297621, 0.15791598, 0.14985269, 0.1392552, 0.12665296,    &
    0.1126123, 0.097714067, 0.082532108, 0.067613401, 0.053459179,            &
    0.040507186, 0.029115703, 0.019548047, 0.011958906, 0.0063814842,         &
    0.00271625, 0.00072062499, 0., 0., 0. /


      data hybi_L55 / &
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,      &
    0, 0, 0, 0, 0, 0, 0, 0, 0.0092923399, 0.02031916, 0.036974858,            &
    0.059487641, 0.087894984, 0.12200361, 0.1614415, 0.20570326, 0.2541886,   &
    0.30623537, 0.36114502, 0.41820228, 0.47668815, 0.53588659, 0.59508425,   &
    0.65356457, 0.71059442, 0.76540524, 0.81716698, 0.86495584, 0.90771586,   &
    0.94421321, 0.97298521, 0.9922815, 1. /
!=======================================================================
!     Initialization of the CAM5 halved hybrid coefficients for 60 full levels
!     the hybrid coefficients of the 61 interface level are listed
!     the coefficients of the full levels are computed via
!     0.5(hyai(i)+hyai(i+1))
!=======================================================================
data hyai_L60 /                                                  &
0.22552395239472E-02,  0.36434656940401E-02,  0.50316918641329E-02, 0.75948196463287E-02,&
0.10157947428524E-01,  0.14356632251292E-01,  0.18555317074060E-01, 0.24612220004201E-01,&
0.30669122934341E-01,  0.38268299773335E-01,  0.45867476612329E-01, 0.54595479741693E-01,&
0.63323482871056E-01,  0.72012450546026E-01,  0.80701418220997E-01, 0.87821230292320E-01,&
0.94941042363644E-01,  0.10331712663174E+00,  0.11169321089983E+00, 0.12154724076390E+00,&
0.13140127062798E+00,  0.14299403876066E+00,  0.15458680689335E+00, 0.16822507977486E+00,&
0.18186335265636E+00,  0.17823067307472E+00,  0.17459799349308E+00, 0.17032432556152E+00,&
0.16605065762997E+00,  0.16102290898561E+00,  0.15599516034126E+00, 0.15008028596640E+00,&
0.14416541159153E+00,  0.13720685988665E+00,  0.13024830818176E+00, 0.12206193804741E+00,&
0.11387556791306E+00,  0.10424471274018E+00,  0.94613857567310E-01, 0.84979154169559E-01,&
0.75344450771809E-01,  0.66501695662737E-01,  0.57658940553665E-01, 0.50196789205074E-01,&
0.42734637856483E-01,  0.37188658490777E-01,  0.31642679125071E-01, 0.28431948274374E-01,&
0.25221217423677E-01,  0.22208977490664E-01,  0.19196737557650E-01, 0.16407382208854E-01,&
0.13618026860058E-01,  0.11074557900429E-01,  0.85310889407992E-02, 0.62549535650760E-02,&
0.39788181893528E-02,  0.19894090946764E-02,  0.00000000000000E+00, 0.00000000000000E+00,&
0.00000000000000E+00 /

data  hybi_L60 /                                                 &
0.00000000000000E+00,  0.00000000000000E+00,  0.00000000000000E+00, 0.00000000000000E+00,&
0.00000000000000E+00,  0.00000000000000E+00,  0.00000000000000E+00, 0.00000000000000E+00,&
0.00000000000000E+00,  0.00000000000000E+00,  0.00000000000000E+00, 0.00000000000000E+00,&
0.00000000000000E+00,  0.00000000000000E+00,  0.00000000000000E+00, 0.00000000000000E+00,&
0.00000000000000E+00,  0.00000000000000E+00,  0.00000000000000E+00, 0.00000000000000E+00,&
0.00000000000000E+00,  0.00000000000000E+00,  0.00000000000000E+00, 0.00000000000000E+00,&
0.00000000000000E+00,  0.19677413627505E-01,  0.39354827255011E-01, 0.62504293397069E-01,&
0.85653759539127E-01,  0.11288790777326E+00,  0.14012205600739E+00, 0.17216161638498E+00,&
0.20420117676258E+00,  0.24189404398203E+00,  0.27958691120148E+00, 0.32393063604832E+00,&
0.36827436089516E+00,  0.42044246196747E+00,  0.47261056303978E+00, 0.52479954063892E+00,&
0.57698851823807E+00,  0.62488773465157E+00,  0.67278695106506E+00, 0.71320769190788E+00,&
0.75362843275070E+00,  0.78366971015930E+00,  0.81371098756790E+00, 0.83110281825066E+00,&
0.84849464893341E+00,  0.86481127142906E+00,  0.88112789392471E+00, 0.89623716473579E+00,&
0.91134643554688E+00,  0.92512384057045E+00,  0.93890124559402E+00, 0.95123052597046E+00,&
0.96355980634689E+00,  0.97433599829674E+00,  0.98511219024658E+00, 0.99255609512329E+00,&
0.10000000000000E+01 /



!=======================================================================
!     60 levels advection with dz=250m
!=======================================================================
      data  hyai_L60_adv /                                                 &
    0.25499234876157, 0.25298180350302, 0.25092494191421,& 
    0.2488206970197, 0.24666797726442, 0.2444656659475, 0.24221262064296, &
    0.23990767260708, 0.23754962617215, 0.23513725812622, 0.23266931707858, &
    0.23014452281059, 0.2275615656116, 0.22491910559957, 0.22221577202596, &
    0.21945016256473, 0.21662084258487, 0.2137263444062, 0.21076516653804, &
    0.20773577290031, 0.2046365920267, 0.20146601624953, 0.19822240086574, &
    0.19490406328374, 0.19150928215057, 0.188036296459, 0.18448330463399, &
    0.18084846359815, 0.17712988781568, 0.17332564831423, 0.16943377168432,& 
    0.16545223905561, 0.16137898504966, 0.15721189670849, 0.15294881239859, &
    0.1485875206895, 0.14412575920672, 0.1395612134581, 0.13489151563322, &
    0.13011424337514, 0.12522691852378, 0.12022700583044, 0.11511191164266,& 
    0.10987898255876, 0.10452550405147, 0.09904869905974, 0.093445726548212,& 
    0.087713680033436, 0.081849586076175, 0.075850402738959, &
    0.069713018008115, 0.063434248179442, 0.057010836206694, &
    0.050439450012026, 0.043716680757511, 0.036839041076842, &
    0.029802963266296, 0.022604797434025, 0.015240809606715, &
    0.0077071797926235, 0 /

      data  hybi_L60_adv /                                                 &
    0, 0.007884727790144, 0.015951093697965, 0.024203282066497,& 
    0.032645573632231, 0.041282347745708, 0.050118084643257, &
    0.059157367771073, 0.06840488616283, 0.077865436872072, &
    0.087543927460629, 0.097445378544368, 0.10757492639758, 0.11793782561738, &
    0.12853945184946, 0.13938530457665, 0.15048100997173, 0.16183232381595, &
    0.17344513448475, 0.18532546600233, 0.19747948116653, 0.20991348474573, &
    0.22263392674937, 0.23564740577382, 0.24896067242537, 0.26258063282196, &
    0.27651435217577, 0.2907690584581, 0.30535214614891, 0.32027118007257, &
    0.33553389932203, 0.35114822127343, 0.36712224569314, 0.38346425893943, &
    0.40018273826091, 0.41728635619404, 0.43478398506192, 0.45268470157671, &
    0.47099779154805, 0.48973275470002, 0.50889930959901, 0.5285073986951, &
    0.54856719347964, 0.56908909976158, 0.59008376306537, 0.61156207415324, &
    0.63353517467465, 0.6560144629459, 0.67901159986292, 0.70253851495018, &
    0.72660741254908, 0.75123077814874, 0.7764213848628, 0.80219230005529, &
    0.82855689211919, 0.85552883741117, 0.88312212734602, 0.91135107565458, &
    0.94023032580885, 0.96977485861809, 1/ 

!=======================================================================
!     67 levels
!=======================================================================
      data hyai_L67 / &
 0.85464139E-04 , 0.11433662E-03 , 0.15066973E-03 ,&
 0.19572874E-03 , 0.25084189E-03 , 0.31737514E-03 , 0.39670380E-03 ,&
 0.49018215E-03 , 0.59911225E-03 , 0.72471315E-03 , 0.86809164E-03 ,&
 0.10302156E-02 , 0.12118912E-02 , 0.14137436E-02 , 0.16492165E-02 ,&
 0.19239097E-02 , 0.22443558E-02 , 0.26181754E-02 , 0.30542582E-02 ,&
 0.35629750E-02 , 0.41564235E-02 , 0.48487167E-02 , 0.56563182E-02 ,&
 0.65984336E-02 , 0.76974676E-02 , 0.89795566E-02 , 0.10475190E-01 ,&
 0.12219936E-01 , 0.14255287E-01 , 0.16629645E-01 , 0.19399476E-01 ,&
 0.22630649E-01 , 0.26400006E-01 , 0.30797187E-01 , 0.35926761E-01 ,&
 0.41910717E-01 , 0.48891359E-01 , 0.57034696E-01 , 0.66534385E-01 ,&
 0.77616342E-01 , 0.90544107E-01 , 0.10562512E+00 , 0.12269463E+00 ,&
 0.13443979E+00 , 0.14736354E+00 , 0.15689206E+00 , 0.16266610E+00 ,&
 0.16465004E+00 , 0.16297621E+00 , 0.15791598E+00 , 0.14985269E+00 ,&
 0.13925520E+00 , 0.12665296E+00 , 0.11261230E+00 , 0.97714067E-01 ,&
 0.82532108E-01 , 0.67613401E-01 , 0.53459179E-01 , 0.40507186E-01 ,&
 0.29115703E-01 , 0.19548047E-01 , 0.11958906E-01 , 0.63814842E-02 ,&
 0.27162500E-02 , 0.72062499E-03 , 0.00000000E+00 , 0.00000000E+00, &
 0.00000000E+00 /

      data hybi_L67 / &
 0.00000000E+00 , 0.00000000E+00 , 0.00000000E+00 ,&
 0.00000000E+00 , 0.00000000E+00 , 0.00000000E+00 , 0.00000000E+00 ,&
 0.00000000E+00 , 0.00000000E+00 , 0.00000000E+00 , 0.00000000E+00 ,&
 0.00000000E+00 , 0.00000000E+00 , 0.00000000E+00 , 0.00000000E+00 ,&
 0.00000000E+00 , 0.00000000E+00 , 0.00000000E+00 , 0.00000000E+00 ,&
 0.00000000E+00 , 0.00000000E+00 , 0.00000000E+00 , 0.00000000E+00 ,&
 0.00000000E+00 , 0.00000000E+00 , 0.00000000E+00 , 0.00000000E+00 ,&
 0.00000000E+00 , 0.00000000E+00 , 0.00000000E+00 , 0.00000000E+00 ,&
 0.00000000E+00 , 0.00000000E+00 , 0.00000000E+00 , 0.00000000E+00 ,&
 0.00000000E+00 , 0.00000000E+00 , 0.00000000E+00 , 0.00000000E+00 ,&
 0.00000000E+00 , 0.00000000E+00 , 0.00000000E+00 , 0.52338717E-03 ,&
 0.93014045E-02 , 0.20319160E-01 , 0.36974858E-01 , 0.59487641E-01 ,&
 0.87894984E-01 , 0.12200361E+00 , 0.16144150E+00 , 0.20570326E+00 ,&
 0.25418860E+00 , 0.30623537E+00 , 0.36114502E+00 , 0.41820228E+00 ,&
 0.47668815E+00 , 0.53588659E+00 , 0.59508425E+00 , 0.65356457E+00 ,&
 0.71059442E+00 , 0.76540524E+00 , 0.81716698E+00 , 0.86495584E+00 ,&
 0.90771586E+00 , 0.94421321E+00 , 0.97298521E+00 , 0.99228150E+00 , 1._r8 /

!=======================================================================
!     Vertical grid: allocatable arrays
!=======================================================================
      real(r8), allocatable :: hyam(:),                      &  ! coefficient a: full model levels
                               hybm(:),                      &  ! coefficient b: full model levels
                               eta(:),                       &  ! eta full model levels
                               lev(:),                       &  ! reference levels in hPa
                               hyai(:),                      &  ! coefficient a: interface levels
                               hybi(:),                      &  ! coefficient b: interface levels
                               etai(:),                      &  ! eta interface levels
                               ilev(:)                          ! reference interface levels in hPa

!=======================================================================
!     Horizontal grid: allocatable arrays
!=======================================================================
      real(r8), allocatable :: lat(:),                                   & ! latitude
                               slat(:),                                  & ! staggered latitude
                               lon(:),                                   & ! longitude
                               slon(:),                                  & ! staggered longitude
                               weight(:)                                   ! normalized integration weights

!=======================================================================
!     position of the NP (in unrotated coordinate system) after a rotation
!=======================================================================
      real(r8) :: lon_np, lat_np
      real(r8) :: rotation_angle                                        ! alpha: between 0 - 90 deg

!=======================================================================
!    Gaussian latitudes and weights for various spectral resolutions 
!     (triangular truncation)
!=======================================================================
      real(r8),target :: T21_gaussian_latitudes(32),                     &
                         T31_gaussian_latitudes(48),                     &
                         T42_gaussian_latitudes(64),                     &
                         T63_gaussian_latitudes(96),                     &
                         T85_gaussian_latitudes(128),                    &
                         T106_gaussian_latitudes(160),                   &
                         T170_gaussian_latitudes(256),                   &
                         T340_gaussian_latitudes(512)

      real(r8), pointer :: gaussian_latitudes(:)

      real(r8),target :: T21_gaussian_weights(32),                       &
                         T31_gaussian_weights(48),                       &
                         T42_gaussian_weights(64),                       &
                         T63_gaussian_weights(96),                       &
                         T85_gaussian_weights(128),                      &
                         T106_gaussian_weights(160),                     &
                         T170_gaussian_weights(256),                     &
                         T340_gaussian_weights(512)

      real(r8), pointer :: gaussian_weights(:)

!=======================================================================
!     Initialization of the Gaussian latitudes
!=======================================================================
      data T21_gaussian_latitudes /                                    &
       -85.7605871204414, -80.2687790722484, -74.7445403686352,        &
       -69.2129761693709, -63.6786355610964, -58.1429540492029,        &
       -52.6065260343451, -47.0696420596871, -41.5324612466559,        &
       -35.9950784112714, -30.4575539611519, -24.9199286299485,        &
       -19.3822313464342, -13.8444837343848,  -8.30670285651877,       &
        -2.76890300773599,  2.76890300773599,  8.30670285651877,       &
        13.8444837343848,  19.3822313464342,  24.9199286299485,        &
        30.4575539611519,  35.9950784112714,  41.5324612466559,        &
        47.0696420596871,  52.6065260343451,  58.1429540492029,        &
        63.6786355610964,  69.2129761693709,  74.7445403686352,        &
        80.2687790722484,  85.7605871204414 /

      data T31_gaussian_latitudes /                                    &
           -87.1590945558628, -83.4789366693172, -79.7770456548256,&
      -76.0702444625451, -72.3615810293448, -68.6520167895175,&
      -64.9419494887575, -61.2315731880771, -57.52099379797, -53.8102740319414,&
      -50.0994534129868, -46.3885581116054, -42.6776061726049,&
      -38.966610469454, -35.2555804613682, -31.5445232840217,&
      -27.8334444519932, -24.122348326088, -20.4112384335678,&
      -16.7001176938427, -12.9889885820881, -9.27785325150786,&
      -5.56671362791359, -1.85557148599326, 1.85557148599326, 5.56671362791359,&
       9.27785325150786, 12.9889885820881, 16.7001176938427, 20.4112384335678, &
       24.122348326088, 27.8334444519932, 31.5445232840217, 35.2555804613682,&
       38.966610469454, 42.6776061726049, 46.3885581116054, 50.0994534129868,&
       53.8102740319414, 57.52099379797, 61.2315731880771, 64.9419494887575,&
       68.6520167895175, 72.3615810293448, 76.0702444625451, 79.7770456548256,&
       83.4789366693172, 87.1590945558628 /


      data T42_gaussian_latitudes /                                    &
       -87.8637988392326, -85.0965269883174, -82.3129129478863, -79.5256065726594, &
       -76.7368996803683, -73.9475151539897, -71.1577520115873, -68.3677561083132, &
       -65.5776070108278, -62.7873517989631, -59.9970201084913, -57.2066315276432, &
       -54.4161995260862, -51.6257336749383, -48.8352409662506, -46.0447266311017, &
       -43.2541946653509, -40.4636481781150, -37.6730896290453, -34.8825209937735, &
       -32.0919438817440, -29.3013596217627, -26.5107693252110, -23.7201739335347, &
       -20.9295742544895, -18.1389709902394, -15.3483647594915, -12.5577561152307, &
        -9.7671455591956,  -6.9765335539486,  -4.1859205331892,  -1.3953069108195, &
         1.3953069108195,   4.1859205331892,   6.9765335539486,   9.7671455591956, &
        12.5577561152307,  15.3483647594915,  18.1389709902394,  20.9295742544895, &
        23.7201739335347,  26.5107693252110,  29.3013596217627,  32.0919438817440, &
        34.8825209937735,  37.6730896290453,  40.4636481781150,  43.2541946653509, &
        46.0447266311017,  48.8352409662506,  51.6257336749383,  54.4161995260862, &
        57.2066315276432,  59.9970201084913,  62.7873517989631,  65.5776070108278, &
        68.3677561083132,  71.1577520115873,  73.9475151539897,  76.7368996803683, &
        79.5256065726594,  82.3129129478863,  85.0965269883174,  87.8637988392326 /

      data T63_gaussian_latitudes /                                    &
       -88.572200, -86.722500, -84.862000, -82.998900, &
       -81.135000, -79.270500, -77.405900, -75.541100, &
       -73.676100, -71.811100, -69.946100, -68.081000, &
       -66.215900, -64.350700, -62.485600, -60.620400, &
       -58.755200, -56.890000, -55.024800, -53.159600, &
       -51.294400, -49.429200, -47.563900, -45.698700, &
       -43.833500, -41.968200, -40.103000, -38.237700, &
       -36.372500, -34.507200, -32.642000, -30.776700, &
       -28.911500, -27.046200, -25.181000, -23.315700, &
       -21.450500, -19.585200, -17.720000, -15.854700, &
       -13.989500, -12.124200, -10.258900,  -8.393700, &
        -6.528400,  -4.663200,  -2.797900,  -0.932600, &
         0.932600,   2.797900,   4.663200,   6.528400, &
         8.393700,  10.258900,  12.124200,  13.989500, &
        15.854700,  17.720000,  19.585200,  21.450500, &
        23.315700,  25.181000,  27.046200,  28.911500, &
        30.776700,  32.642000,  34.507200,  36.372500, &
        38.237700,  40.103000,  41.968200,  43.833500, &
        45.698700,  47.563900,  49.429200,  51.294400, &
        53.159600,  55.024800,  56.890000,  58.755200, &
        60.620400,  62.485600,  64.350700,  66.215900, &
        68.081000,  69.946100,  71.811100,  73.676100, &
        75.541100,  77.405900,  79.270500,  81.135000, &
        82.998900,  84.862000,  86.722500,  88.572200 /

      data T85_gaussian_latitudes /                                                &
       -88.9277353522959, -87.5387052130272, -86.1414721015279, -84.7423855907142, &
       -83.3425960440704, -81.9424662991732, -80.5421464346171, -79.1417096486217, &
       -77.7411958655139, -76.3406287023715, -74.9400230196494, -73.5393886337675, &
       -72.1387322891624, -70.7380587725176, -69.3373715749609, -67.9366733025785, &
       -66.5359659401756, -65.1352510260352, -63.7345297708429, -62.3338031405324, &
       -60.9330719152074, -59.5323367318266, -58.1315981156439, -56.7308565037137, &
       -55.3301122627028, -53.9293657025561, -52.5286170870997, -51.1278666423533, &
       -49.7271145631097, -48.3263610181882, -46.9256061546646, -45.5248501013023, &
       -44.1240929713559, -42.7233348648770, -41.3225758706231, -39.9218160676465, &
       -38.5210555266244, -37.1202943109788, -35.7195324778240, -34.3187700787707, &
       -32.9180071606140, -31.5172437659226, -30.1164799335463, -28.7157156990552, &
       -27.3149510951204, -25.9141861518467, -24.5134208970629, -23.1126553565776, &
       -21.7118895544042, -20.3111235129604, -18.9103572532454, -17.5095907949986, &
       -16.1088241568413, -14.7080573564048, -13.3072904104462, -11.9065233349538, &
       -10.5057561452436,  -9.1049888560485,  -7.7042214816005,  -6.3034540357076, &
        -4.9026865318265,  -3.5019189831313,  -2.1011514025790,  -0.7003838029733, &
         0.7003838029733,   2.1011514025790,   3.5019189831313,   4.9026865318265, &
         6.3034540357076,   7.7042214816005,   9.1049888560485,  10.5057561452436, &
        11.9065233349538,  13.3072904104462,  14.7080573564048,  16.1088241568413, &
        17.5095907949986,  18.9103572532454,  20.3111235129604,  21.7118895544042, &
        23.1126553565776,  24.5134208970629,  25.9141861518467,  27.3149510951204, &
        28.7157156990552,  30.1164799335463,  31.5172437659226,  32.9180071606140, &
        34.3187700787707,  35.7195324778240,  37.1202943109788,  38.5210555266244, &
        39.9218160676465,  41.3225758706231,  42.7233348648770,  44.1240929713559, &
        45.5248501013023,  46.9256061546646,  48.3263610181882,  49.7271145631097, &
        51.1278666423533,  52.5286170870997,  53.9293657025561,  55.3301122627028, &
        56.7308565037137,  58.1315981156439,  59.5323367318266,  60.9330719152074, &
        62.3338031405324,  63.7345297708429,  65.1352510260352,  66.5359659401756, &
        67.9366733025785,  69.3373715749609,  70.7380587725176,  72.1387322891624, &
        73.5393886337675,  74.9400230196494,  76.3406287023715,  77.7411958655139, &
        79.1417096486217,  80.5421464346171,  81.9424662991732,  83.3425960440704, &
        84.7423855907142,  86.1414721015279,  87.5387052130272,  88.9277353522959 /

      data T106_gaussian_latitudes /                   &
       -89.141600, -88.029400, -86.910800, -85.790600, &
       -84.669900, -83.548900, -82.427800, -81.306600, &
       -80.185300, -79.064000, -77.942600, -76.821200, &
       -75.699800, -74.578400, -73.457000, -72.335600, &
       -71.214100, -70.092700, -68.971200, -67.849800, &
       -66.728300, -65.606900, -64.485400, -63.363900, &
       -62.242500, -61.121000, -59.999500, -58.878000, &
       -57.756600, -56.635100, -55.513600, -54.392100, &
       -53.270700, -52.149200, -51.027700, -49.906200, &
       -48.784700, -47.663200, -46.541800, -45.420300, &
       -44.298800, -43.177300, -42.055800, -40.934300, &
       -39.812900, -38.691400, -37.569900, -36.448400, &
       -35.326900, -34.205400, -33.083900, -31.962400, &
       -30.841000, -29.719500, -28.598000, -27.476500, &
       -26.355000, -25.233500, -24.112000, -22.990500, &
       -21.869000, -20.747600, -19.626100, -18.504600, &
       -17.383100, -16.261600, -15.140100, -14.018600, &
       -12.897100, -11.775600, -10.654200,  -9.532700, &
        -8.411200,  -7.289700,  -6.168200,  -5.046700, &
        -3.925200,  -2.803700,  -1.682200,  -0.560700, &
         0.560700,   1.682200,   2.803700,   3.925200, &
         5.046700,   6.168200,   7.289700,   8.411200, &
         9.532700,  10.654200,  11.775600,  12.897100, &
        14.018600,  15.140100,  16.261600,  17.383100, &
        18.504600,  19.626100,  20.747600,  21.869000, &
        22.990500,  24.112000,  25.233500,  26.355000, &
        27.476500,  28.598000,  29.719500,  30.841000, &
        31.962400,  33.083900,  34.205400,  35.326900, &
        36.448400,  37.569900,  38.691400,  39.812900, &
        40.934300,  42.055800,  43.177300,  44.298800, &
        45.420300,  46.541800,  47.663200,  48.784700, &
        49.906200,  51.027700,  52.149200,  53.270700, &
        54.392100,  55.513600,  56.635100,  57.756600, &
        58.878000,  59.999500,  61.121000,  62.242500, &
        63.363900,  64.485400,  65.606900,  66.728300, &
        67.849800,  68.971200,  70.092700,  71.214100, &
        72.335600,  73.457000,  74.578400,  75.699800, &
        76.821200,  77.942600,  79.064000,  80.185300, &
        81.306600,  82.427800,  83.548900,  84.669900, &
        85.790600,  86.910800,  88.029400,  89.141600 /

      data T170_gaussian_latitudes /                                               &
       -89.4628215685774, -88.7669513528422, -88.0669716474306, -87.3660634330820, &
       -86.6648030134408, -85.9633721608804, -85.2618460607126, -84.5602613830534, &
       -83.8586381286076, -83.1569881285417, -82.4553188271638, -81.7536351418384, &
       -81.0519404509364, -80.3502371520357, -79.6485269936663, -78.9468112809667, &
       -78.2450910078212, -77.5433669444091, -76.8416396967821, -76.1399097483681, &
       -75.4381774894879, -74.7364432387392, -74.0347072587468, -73.3329697679366, &
       -72.6312309494589, -71.9294909580333, -71.2277499252598, -70.5260079637821, &
       -69.8242651705826, -69.1225216296136, -68.4207774139149, -67.7190325873316, &
       -67.0172872059174, -66.3155413190886, -65.6137949705788, -64.9120481992332, &
       -64.2103010396741, -63.5085535228595, -62.8068056765562, -62.1050575257411, &
       -61.4033090929433, -60.7015603985375, -59.9998114609959, -59.2980622971053, &
       -58.5963129221560, -57.8945633501051, -57.1928135937188, -56.4910636646978, &
       -55.7893135737860, -55.0875633308672, -54.3858129450494, -53.6840624247402, &
       -52.9823117777130, -52.2805610111665, -51.5788101317763, -50.8770591457431, &
       -50.1753080588334, -49.4735568764181, -48.7718056035057, -48.0700542447729, &
       -47.3683028045918, -46.6665512870549, -45.9647996959973, -45.2630480350169, &
       -44.5612963074929, -43.8595445166024, -43.1577926653356, -42.4560407565100, &
       -41.7542887927827, -41.0525367766618, -40.3507847105177, -39.6490325965920, &
       -38.9472804370071, -38.2455282337738, -37.5437759887994, -36.8420237038942, &
       -36.1402713807780, -35.4385190210863, -34.7367666263753, -34.0350141981274, &
       -33.3332617377555, -32.6315092466078, -31.9297567259713, -31.2280041770759, &
       -30.5262516010979, -29.8244989991631, -29.1227463723498, -28.4209937216919, &
       -27.7192410481810, -27.0174883527696, -26.3157356363728, -25.6139828998707, &
       -24.9122301441104, -24.2104773699079, -23.5087245780500, -22.8069717692958, &
       -22.1052189443783, -21.4034661040060, -20.7017132488643, -19.9999603796168, &
       -19.2982074969063, -18.5964546013566, -17.8947016935729, -17.1929487741434, &
       -16.4911958436402, -15.7894429026201, -15.0876899516255, -14.3859369911856, &
       -13.6841840218169, -12.9824310440242, -12.2806780583011, -11.5789250651313, &
       -10.8771720649885, -10.1754190583378,  -9.4736660456359,  -8.7719130273320, &
        -8.0701600038681,  -7.3684069756800,  -6.6666539431975,  -5.9649009068453, &
        -5.2631478670432,  -4.5613948242067,  -3.8596417787480,  -3.1578887310756, &
        -2.4561356815958,  -1.7543826307124,  -1.0526295788276,  -0.3508765263426, &
         0.3508765263426,   1.0526295788276,   1.7543826307124,   2.4561356815958, &
         3.1578887310756,   3.8596417787480,   4.5613948242067,   5.2631478670432, &
         5.9649009068453,   6.6666539431975,   7.3684069756800,   8.0701600038681, &
         8.7719130273320,   9.4736660456359,  10.1754190583378,  10.8771720649885, &
        11.5789250651313,  12.2806780583011,  12.9824310440242,  13.6841840218169, &
        14.3859369911856,  15.0876899516255,  15.7894429026201,  16.4911958436402, &
        17.1929487741434,  17.8947016935729,  18.5964546013566,  19.2982074969063, &
        19.9999603796168,  20.7017132488643,  21.4034661040060,  22.1052189443783, &
        22.8069717692958,  23.5087245780500,  24.2104773699079,  24.9122301441104, &
        25.6139828998707,  26.3157356363728,  27.0174883527696,  27.7192410481810, &
        28.4209937216919,  29.1227463723498,  29.8244989991631,  30.5262516010979, &
        31.2280041770759,  31.9297567259713,  32.6315092466078,  33.3332617377555, &
        34.0350141981274,  34.7367666263753,  35.4385190210863,  36.1402713807780, &
        36.8420237038942,  37.5437759887994,  38.2455282337738,  38.9472804370071, &
        39.6490325965920,  40.3507847105177,  41.0525367766618,  41.7542887927827, &
        42.4560407565100,  43.1577926653356,  43.8595445166024,  44.5612963074929, &
        45.2630480350169,  45.9647996959973,  46.6665512870549,  47.3683028045918, &
        48.0700542447729,  48.7718056035057,  49.4735568764181,  50.1753080588334, &
        50.8770591457431,  51.5788101317763,  52.2805610111665,  52.9823117777130, &
        53.6840624247402,  54.3858129450494,  55.0875633308672,  55.7893135737860, &
        56.4910636646978,  57.1928135937188,  57.8945633501051,  58.5963129221560, &
        59.2980622971053,  59.9998114609959,  60.7015603985375,  61.4033090929433, &
        62.1050575257411,  62.8068056765562,  63.5085535228595,  64.2103010396741, &
        64.9120481992332,  65.6137949705788,  66.3155413190886,  67.0172872059174, &
        67.7190325873316,  68.4207774139149,  69.1225216296136,  69.8242651705826, &
        70.5260079637821,  71.2277499252598,  71.9294909580333,  72.6312309494589, &
        73.3329697679366,  74.0347072587468,  74.7364432387392,  75.4381774894879, &
        76.1399097483681,  76.8416396967821,  77.5433669444091,  78.2450910078212, &
        78.9468112809667,  79.6485269936663,  80.3502371520357,  81.0519404509364, &
        81.7536351418384,  82.4553188271638,  83.1569881285417,  83.8586381286076, &
        84.5602613830534,  85.2618460607126,  85.9633721608804,  86.6648030134408, &
        87.3660634330820,  88.0669716474306,  88.7669513528422,  89.4628215685774 /

      data T340_gaussian_latitudes /                                               &
       -89.7311486184132, -89.3828738963340, -89.0325424237896, -88.6817462435906, -88.3307737888069, -87.9797160343259, &
       -87.6286106094841, -87.2774758672237, -86.9263218176458, -86.5751543820948, -86.2239772863455, -85.8727929914671, &
       -85.5216031882812, -85.1704090767342, -84.8192115319314, -84.4680112070664, -84.1168085995531, -83.7656040948442, &
       -83.4143979962483, -83.0631905457020, -82.7119819385430, -82.3607723342126, -82.0095618641376, -81.6583506376243, &
       -81.3071387463237, -80.9559262676574, -80.6047132674760, -80.2534998021422, -79.9022859201808, -79.5510716635948, &
       -79.1998570689256, -78.8486421681124, -78.4974269891952, -78.1462115568916, -77.7949958930750, -77.4437800171722, &
       -77.0925639464961, -76.7413476965258, -76.3901312811428, -76.0389147128323, -75.6876980028543, -75.3364811613901, &
       -74.9852641976689, -74.6340471200761, -74.2828299362480, -73.9316126531531, -73.5803952771642, -73.2291778141201, &
       -72.8779602693810, -72.5267426478760, -72.1755249541458, -71.8243071923805, -71.4730893664524, -71.1218714799457, &
       -70.7706535361830, -70.4194355382484, -70.0682174890089, -69.7169993911329, -69.3657812471073, -69.0145630592524, &
       -68.6633448297360, -68.3121265605855, -67.9609082536991, -67.6096899108560, -67.2584715337256, -66.9072531238758, &
       -66.5560346827804, -66.2048162118267, -65.8535977123208, -65.5023791854945, -65.1511606325096, -64.7999420544635, &
       -64.4487234523930, -64.0975048272792, -63.7462861800503, -63.3950675115857, -63.0438488227192, -62.6926301142415, &
       -62.3414113869034, -61.9901926414180, -61.6389738784632, -61.2877550986836, -60.9365363026930, -60.5853174910758, &
       -60.2340986643887, -59.8828798231628, -59.5316609679046, -59.1804420990975, -58.8292232172034, -58.4780043226634, &
       -58.1267854158993, -57.7755664973148, -57.4243475672959, -57.0731286262123, -56.7219096744183, -56.3706907122533, &
       -56.0194717400428, -55.6682527580989, -55.3170337667213, -54.9658147661976, -54.6145957568040, -54.2633767388061, &
       -53.9121577124591, -53.5609386780083, -53.2097196356898, -52.8585005857310, -52.5072815283504, -52.1560624637589, &
       -51.8048433921593, -51.4536243137474, -51.1024052287118, -50.7511861372345, -50.3999670394908, -50.0487479356504, &
       -49.6975288258768, -49.3463097103278, -48.9950905891562, -48.6438714625095, -48.2926523305301, -47.9414331933560, &
       -47.5902140511205, -47.2389949039526, -46.8877757519773, -46.5365565953153, -46.1853374340839, -45.8341182683963, &
       -45.4828990983625, -45.1316799240890, -44.7804607456790, -44.4292415632326, -44.0780223768470, -43.7268031866163, &
       -43.3755839926321, -43.0243647949830, -42.6731455937553, -42.3219263890326, -41.9707071808963, -41.6194879694254, &
       -41.2682687546966, -40.9170495367847, -40.5658303157622, -40.2146110916997, -39.8633918646659, -39.5121726347275, &
       -39.1609534019498, -38.8097341663959, -38.4585149281275, -38.1072956872047, -37.7560764436860, -37.4048571976283, &
       -37.0536379490872, -36.7024186981169, -36.3511994447700, -35.9999801890982, -35.6487609311515, -35.2975416709790, &
       -34.9463224086285, -34.5951031441466, -34.2438838775788, -33.8926646089697, -33.5414453383626, -33.1902260658000, &
       -32.8390067913233, -32.4877875149730, -32.1365682367886, -31.7853489568090, -31.4341296750718, -31.0829103916141, &
       -30.7316911064722, -30.3804718196813, -30.0292525312763, -29.6780332412909, -29.3268139497584, -28.9755946567113, &
       -28.6243753621814, -28.2731560662000, -27.9219367687976, -27.5707174700042, -27.2194981698490, -26.8682788683609, &
       -26.5170595655681, -26.1658402614983, -25.8146209561786, -25.4634016496356, -25.1121823418955, -24.7609630329839, &
       -24.4097437229261, -24.0585244117467, -23.7073050994701, -23.3560857861200, -23.0048664717201, -22.6536471562932, &
       -22.3024278398621, -21.9512085224490, -21.5999892040758, -21.2487698847640, -20.8975505645350, -20.5463312434094, &
       -20.1951119214078, -19.8438925985505, -19.4926732748573, -19.1414539503479, -18.7902346250414, -18.4390152989571, &
       -18.0877959721135, -17.7365766445292, -17.3853573162224, -17.0341379872112, -16.6829186575131, -16.3316993271457, &
       -15.9804799961263, -15.6292606644719, -15.2780413321993, -14.9268219993252, -14.5756026658660, -14.2243833318380, &
       -13.8731639972570, -13.5219446621391, -13.1707253264999, -12.8195059903548, -12.4682866537193, -12.1170673166086, &
       -11.7658479790376, -11.4146286410212, -11.0634093025743, -10.7121899637113, -10.3609706244468, -10.0097512847951, &
        -9.6585319447705,  -9.3073126043869,  -8.9560932636586,  -8.6048739225992,  -8.2536545812226,  -7.9024352395425, &
        -7.5512158975725,  -7.1999965553261,  -6.8487772128167,  -6.4975578700576,  -6.1463385270620,  -5.7951191838433, &
        -5.4438998404144,  -5.0926804967884,  -4.7414611529784,  -4.3902418089972,  -4.0390224648578,  -3.6878031205729, &
        -3.3365837761554,  -2.9853644316180,  -2.6341450869735,  -2.2829257422345,  -1.9317063974137,  -1.5804870525237, &
        -1.2292677075770,  -0.8780483625864,  -0.5268290175644,  -0.1756096725236,   0.1756096725236,   0.5268290175644, &
         0.8780483625864,   1.2292677075770,   1.5804870525237,   1.9317063974137,   2.2829257422345,   2.6341450869735, &
         2.9853644316180,   3.3365837761554,   3.6878031205729,   4.0390224648578,   4.3902418089972,   4.7414611529784, &
         5.0926804967884,   5.4438998404144,   5.7951191838433,   6.1463385270620,   6.4975578700576,   6.8487772128167, &
         7.1999965553261,   7.5512158975725,   7.9024352395425,   8.2536545812226,   8.6048739225992,   8.9560932636586, &
         9.3073126043869,   9.6585319447705,  10.0097512847951,  10.3609706244468,  10.7121899637113,  11.0634093025743, &
        11.4146286410212,  11.7658479790376,  12.1170673166086,  12.4682866537193,  12.8195059903548,  13.1707253264999, &
        13.5219446621391,  13.8731639972570,  14.2243833318380,  14.5756026658660,  14.9268219993252,  15.2780413321993, &
        15.6292606644719,  15.9804799961263,  16.3316993271457,  16.6829186575131,  17.0341379872112,  17.3853573162224, &
        17.7365766445292,  18.0877959721135,  18.4390152989571,  18.7902346250414,  19.1414539503479,  19.4926732748573, &
        19.8438925985505,  20.1951119214078,  20.5463312434094,  20.8975505645350,  21.2487698847640,  21.5999892040758, &
        21.9512085224490,  22.3024278398621,  22.6536471562932,  23.0048664717201,  23.3560857861200,  23.7073050994701, &
        24.0585244117467,  24.4097437229261,  24.7609630329839,  25.1121823418955,  25.4634016496356,  25.8146209561786, &
        26.1658402614983,  26.5170595655681,  26.8682788683609,  27.2194981698490,  27.5707174700042,  27.9219367687976, &
        28.2731560662000,  28.6243753621814,  28.9755946567113,  29.3268139497584,  29.6780332412909,  30.0292525312763, &
        30.3804718196813,  30.7316911064722,  31.0829103916141,  31.4341296750718,  31.7853489568090,  32.1365682367886, &
        32.4877875149730,  32.8390067913233,  33.1902260658000,  33.5414453383626,  33.8926646089697,  34.2438838775788, &
        34.5951031441466,  34.9463224086285,  35.2975416709790,  35.6487609311515,  35.9999801890982,  36.3511994447700, &
        36.7024186981169,  37.0536379490872,  37.4048571976283,  37.7560764436860,  38.1072956872047,  38.4585149281275, &
        38.8097341663959,  39.1609534019498,  39.5121726347275,  39.8633918646659,  40.2146110916997,  40.5658303157622, &
        40.9170495367847,  41.2682687546966,  41.6194879694254,  41.9707071808963,  42.3219263890326,  42.6731455937553, &
        43.0243647949830,  43.3755839926321,  43.7268031866163,  44.0780223768470,  44.4292415632326,  44.7804607456790, &
        45.1316799240890,  45.4828990983625,  45.8341182683963,  46.1853374340839,  46.5365565953153,  46.8877757519773, &
        47.2389949039526,  47.5902140511205,  47.9414331933560,  48.2926523305301,  48.6438714625095,  48.9950905891562, &
        49.3463097103278,  49.6975288258768,  50.0487479356504,  50.3999670394908,  50.7511861372345,  51.1024052287118, &
        51.4536243137474,  51.8048433921593,  52.1560624637589,  52.5072815283504,  52.8585005857310,  53.2097196356898, &
        53.5609386780083,  53.9121577124591,  54.2633767388061,  54.6145957568040,  54.9658147661976,  55.3170337667213, &
        55.6682527580989,  56.0194717400428,  56.3706907122533,  56.7219096744183,  57.0731286262123,  57.4243475672959, &
        57.7755664973148,  58.1267854158993,  58.4780043226634,  58.8292232172034,  59.1804420990975,  59.5316609679046, &
        59.8828798231628,  60.2340986643887,  60.5853174910758,  60.9365363026930,  61.2877550986836,  61.6389738784632, &
        61.9901926414180,  62.3414113869034,  62.6926301142415,  63.0438488227192,  63.3950675115857,  63.7462861800503, &
        64.0975048272792,  64.4487234523930,  64.7999420544635,  65.1511606325096,  65.5023791854945,  65.8535977123208, &
        66.2048162118267,  66.5560346827804,  66.9072531238758,  67.2584715337256,  67.6096899108560,  67.9609082536991, &
        68.3121265605855,  68.6633448297360,  69.0145630592524,  69.3657812471073,  69.7169993911329,  70.0682174890089, &
        70.4194355382484,  70.7706535361830,  71.1218714799457,  71.4730893664524,  71.8243071923805,  72.1755249541458, &
        72.5267426478760,  72.8779602693810,  73.2291778141201,  73.5803952771642,  73.9316126531531,  74.2828299362480, &
        74.6340471200761,  74.9852641976689,  75.3364811613901,  75.6876980028543,  76.0389147128323,  76.3901312811428, &
        76.7413476965258,  77.0925639464961,  77.4437800171722,  77.7949958930750,  78.1462115568916,  78.4974269891952, &
        78.8486421681124,  79.1998570689256,  79.5510716635948,  79.9022859201808,  80.2534998021422,  80.6047132674760, &
        80.9559262676574,  81.3071387463237,  81.6583506376243,  82.0095618641376,  82.3607723342126,  82.7119819385430, &
        83.0631905457020,  83.4143979962483,  83.7656040948442,  84.1168085995531,  84.4680112070664,  84.8192115319314, &
        85.1704090767342,  85.5216031882812,  85.8727929914671,  86.2239772863455,  86.5751543820948,  86.9263218176458, &
        87.2774758672237,  87.6286106094841,  87.9797160343259,  88.3307737888069,  88.6817462435906,  89.0325424237896, &
        89.3828738963340,  89.7311486184132 /

!=======================================================================
!     Initialization of the Gaussian weights
!=======================================================================
      data T21_gaussian_weights /                                                  &
         0.0070186100095,   0.0162743947309,   0.0253920653093,   0.0342738629130, &
         0.0428358980222,   0.0509980592624,   0.0586840934785,   0.0658222227764, &
         0.0723457941088,   0.0781938957871,   0.0833119242269,   0.0876520930044, &
         0.0911738786958,   0.0938443990808,   0.0956387200793,   0.0965400885147, &
         0.0965400885147,   0.0956387200793,   0.0938443990808,   0.0911738786958, &
         0.0876520930044,   0.0833119242269,   0.0781938957871,   0.0723457941088, &
         0.0658222227764,   0.0586840934785,   0.0509980592624,   0.0428358980222, &
         0.0342738629130,   0.0253920653093,   0.0162743947309,   0.0070186100095 /

      data T31_gaussian_weights /                                                  &
         0.00315334605230584, 0.00732755390127626, 0.0114772345792345, &
         0.0155793157229438, 0.0196161604573555, 0.0235707608393244,&
         0.0274265097083569, 0.0311672278327981, 0.0347772225647704,&
         0.0382413510658307, 0.0415450829434647, 0.0446745608566943,&
         0.0476166584924905, 0.0503590355538545, 0.0528901894851937,&
         0.0551995036999842, 0.0572772921004032, 0.0591148396983956,&
         0.0607044391658939, 0.0620394231598927, 0.063114192286254,&
         0.0639242385846482, 0.0644661644359501, 0.0647376968126839,&
         0.0647376968126839, 0.0644661644359501, 0.0639242385846482,&
         0.063114192286254, 0.0620394231598927, 0.0607044391658939,&
         0.0591148396983956, 0.0572772921004032, 0.0551995036999842,&
         0.0528901894851937, 0.0503590355538545, 0.0476166584924905,&
         0.0446745608566943, 0.0415450829434647, 0.0382413510658307,&
         0.0347772225647704, 0.0311672278327981, 0.0274265097083569,&
         0.0235707608393244, 0.0196161604573555, 0.0155793157229438,&
         0.0114772345792345, 0.00732755390127626, 0.00315334605230584 /


      data T42_gaussian_weights /                                                  &
         0.0017832807217,   0.0041470332606,   0.0065044579690,   0.0088467598264, &
         0.0111681394601,   0.0134630478967,   0.0157260304760,   0.0179517157757, &
         0.0201348231535,   0.0222701738084,   0.0243527025687,   0.0263774697151, &
         0.0283396726143,   0.0302346570724,   0.0320579283549,   0.0338051618371, &
         0.0354722132569,   0.0370551285402,   0.0385501531786,   0.0399537411327, &
         0.0412625632426,   0.0424735151237,   0.0435837245293,   0.0445905581638, &
         0.0454916279274,   0.0462847965813,   0.0469681828162,   0.0475401657148, &
         0.0479993885965,   0.0483447622348,   0.0485754674415,   0.0486909570091, &
         0.0486909570091,   0.0485754674415,   0.0483447622348,   0.0479993885965, &
         0.0475401657148,   0.0469681828162,   0.0462847965813,   0.0454916279274, &
         0.0445905581638,   0.0435837245293,   0.0424735151237,   0.0412625632426, &
         0.0399537411327,   0.0385501531786,   0.0370551285402,   0.0354722132569, &
         0.0338051618371,   0.0320579283549,   0.0302346570724,   0.0283396726143, &
         0.0263774697151,   0.0243527025687,   0.0222701738084,   0.0201348231535, &
         0.0179517157757,   0.0157260304760,   0.0134630478967,   0.0111681394601, &
         0.0088467598264,   0.0065044579690,   0.0041470332606,   0.0017832807217 /

      data T63_gaussian_weights /                          &
         0.0007930,   0.0018530,   0.0029090,   0.0039660, &
         0.0050150,   0.0060590,   0.0070970,   0.0081270, &
         0.0091480,   0.0101610,   0.0111620,   0.0121520, &
         0.0131280,   0.0140910,   0.0150390,   0.0159710, &
         0.0168860,   0.0177830,   0.0186610,   0.0195190, &
         0.0203570,   0.0211730,   0.0219670,   0.0227370, &
         0.0234830,   0.0242050,   0.0249010,   0.0255700, &
         0.0262120,   0.0268270,   0.0274130,   0.0279710, &
         0.0284980,   0.0289950,   0.0294610,   0.0298970, &
         0.0303000,   0.0306710,   0.0310100,   0.0313160, &
         0.0315890,   0.0318290,   0.0320350,   0.0322070, &
         0.0323440,   0.0324470,   0.0325170,   0.0325510, &
         0.0325510,   0.0325170,   0.0324470,   0.0323440, &
         0.0322070,   0.0320350,   0.0318290,   0.0315890, &
         0.0313160,   0.0310100,   0.0306710,   0.0303000, &
         0.0298970,   0.0294610,   0.0289950,   0.0284980, &
         0.0279710,   0.0274130,   0.0268270,   0.0262120, &
         0.0255700,   0.0249010,   0.0242050,   0.0234830, &
         0.0227370,   0.0219670,   0.0211730,   0.0203570, &
         0.0195190,   0.0186610,   0.0177830,   0.0168860, &
         0.0159710,   0.0150390,   0.0140910,   0.0131280, &
         0.0121520,   0.0111620,   0.0101610,   0.0091480, &
         0.0081270,   0.0070970,   0.0060590,   0.0050150, &
         0.0039660,   0.0029090,   0.0018530,   0.0007930 /

      data T85_gaussian_weights /                                                  &
         0.0004493809603,   0.0010458126793,   0.0016425030187,   0.0022382884310, &
         0.0028327514715,   0.0034255260409,   0.0040162549837,   0.0046045842567, &
         0.0051901618327,   0.0057726375429,   0.0063516631617,   0.0069268925669, &
         0.0074979819256,   0.0080645898905,   0.0086263777986,   0.0091830098717, &
         0.0097341534150,   0.0102794790158,   0.0108186607395,   0.0113513763241, &
         0.0118773073727,   0.0123961395440,   0.0129075627393,   0.0134112712886, &
         0.0139069641330,   0.0143943450042,   0.0148731226021,   0.0153430107689, &
         0.0158037286594,   0.0162550009098,   0.0166965578016,   0.0171281354231, &
         0.0175494758271,   0.0179603271850,   0.0183604439373,   0.0187495869405, &
         0.0191275236100,   0.0194940280587,   0.0198488812328,   0.0201918710421, &
         0.0205227924870,   0.0208414477808,   0.0211476464682,   0.0214412055392, &
         0.0217219495381,   0.0219897106685,   0.0222443288938,   0.0224856520327, &
         0.0227135358502,   0.0229278441437,   0.0231284488244,   0.0233152299941, &
         0.0234880760165,   0.0236468835844,   0.0237915577810,   0.0239220121367, &
         0.0240381686810,   0.0241399579890,   0.0242273192228,   0.0243002001680, &
         0.0243585572647,   0.0244023556338,   0.0244315690978,   0.0244461801963, &
         0.0244461801963,   0.0244315690978,   0.0244023556338,   0.0243585572647, &
         0.0243002001680,   0.0242273192228,   0.0241399579890,   0.0240381686810, &
         0.0239220121367,   0.0237915577810,   0.0236468835844,   0.0234880760165, &
         0.0233152299941,   0.0231284488244,   0.0229278441437,   0.0227135358502, &
         0.0224856520327,   0.0222443288938,   0.0219897106685,   0.0217219495381, &
         0.0214412055392,   0.0211476464682,   0.0208414477808,   0.0205227924870, &
         0.0201918710421,   0.0198488812328,   0.0194940280587,   0.0191275236100, &
         0.0187495869405,   0.0183604439373,   0.0179603271850,   0.0175494758271, &
         0.0171281354231,   0.0166965578016,   0.0162550009098,   0.0158037286594, &
         0.0153430107689,   0.0148731226021,   0.0143943450042,   0.0139069641330, &
         0.0134112712886,   0.0129075627393,   0.0123961395440,   0.0118773073727, &
         0.0113513763241,   0.0108186607395,   0.0102794790158,   0.0097341534150, &
         0.0091830098717,   0.0086263777986,   0.0080645898905,   0.0074979819256, &
         0.0069268925669,   0.0063516631617,   0.0057726375429,   0.0051901618327, &
         0.0046045842567,   0.0040162549837,   0.0034255260409,   0.0028327514715, &
         0.0022382884310,   0.0016425030187,   0.0010458126793,   0.0004493809603 /

      data T106_gaussian_weights /                                                 &
     0.0002880585285,   0.0006704383202,   0.0010531276722,   0.0014354627535,     &
     0.0018172577597,   0.0021983594968,   0.0025786201218,   0.0029578933250, &
     0.0033360335478,   0.0037128958026,   0.0040883356486,   0.0044622092163, &
     0.0048343732497,   0.0052046851544,   0.0055730030499,   0.0059391858215, &
     0.0063030931743,   0.0066645856858,   0.0070235248595,   0.0073797731773, &
     0.0077331941523,   0.0080836523810,   0.0084310135953,   0.0087751447136, &
     0.0091159138917,   0.0094531905737,   0.0097868455418,   0.0101167509657, &
     0.0104427804516,   0.0107648090908,   0.0110827135073,   0.0113963719053, &
     0.0117056641156,   0.0120104716419,   0.0123106777061,   0.0126061672930, &
     0.0128968271942,   0.0131825460519,   0.0134632144013,   0.0137387247124, &
     0.0140089714314,   0.0142738510212,   0.0145332620010,   0.0147871049848, &
     0.0150352827203,   0.0152777001252,   0.0155142643245,   0.0157448846854, &
     0.0159694728525,   0.0161879427813,   0.0164002107716,   0.0166061954988, &
     0.0168058180462,   0.0169990019339,   0.0171856731493,   0.0173657601748, &
     0.0175391940152,   0.0177059082244,   0.0178658389308,   0.0180189248614, &
     0.0181651073660,   0.0183043304389,   0.0184365407409,   0.0185616876195, &
     0.0186797231282,   0.0187906020452,   0.0188942818905,   0.0189907229422, &
     0.0190798882516,   0.0191617436578,   0.0192362578001,   0.0193034021307, &
     0.0193631509251,   0.0194154812924,   0.0194603731837,   0.0194978094000, &
     0.0195277755986,   0.0195502602990,   0.0195652548867,   0.0195727536170, &
     0.0195727536170,   0.0195652548867,   0.0195502602990,   0.0195277755986, &
     0.0194978094000,   0.0194603731837,   0.0194154812924,   0.0193631509251, &
     0.0193034021307,   0.0192362578001,   0.0191617436578,   0.0190798882516, &
     0.0189907229422,   0.0188942818905,   0.0187906020452,   0.0186797231282, &
     0.0185616876195,   0.0184365407409,   0.0183043304389,   0.0181651073660, &
     0.0180189248614,   0.0178658389308,   0.0177059082244,   0.0175391940152, &
     0.0173657601748,   0.0171856731493,   0.0169990019339,   0.0168058180462, &
     0.0166061954989,   0.0164002107716,   0.0161879427813,   0.0159694728525, &
     0.0157448846854,   0.0155142643245,   0.0152777001252,   0.0150352827203, &
     0.0147871049848,   0.0145332620010,   0.0142738510212,   0.0140089714314, &
     0.0137387247124,   0.0134632144013,   0.0131825460519,   0.0128968271942, &
     0.0126061672930,   0.0123106777061,   0.0120104716419,   0.0117056641156, &
     0.0113963719053,   0.0110827135073,   0.0107648090908,   0.0104427804516, &
     0.0101167509657,   0.0097868455418,   0.0094531905737,   0.0091159138917, &
     0.0087751447136,   0.0084310135953,   0.0080836523810,   0.0077331941523, &
     0.0073797731773,   0.0070235248595,   0.0066645856858,   0.0063030931743, &
     0.0059391858215,   0.0055730030499,   0.0052046851544,   0.0048343732497, &
     0.0044622092163,   0.0040883356486,   0.0037128958026,   0.0033360335478, &
     0.0029578933250,   0.0025786201218,   0.0021983594968,   0.0018172577597, &
     0.0014354627535,   0.0010531276722,   0.0006704383202,   0.0002880585285 /

      ! 160*0.d0/              ! provide later

      data T170_gaussian_weights /                                                 &
         0.0001127890178,   0.0002625349443,   0.0004124632544,   0.0005623489540, &
         0.0007121541635,   0.0008618537014,   0.0010114243932,   0.0011608435576, &
         0.0013100886819,   0.0014591373333,   0.0016079671307,   0.0017565557363, &
         0.0019048808535,   0.0020529202280,   0.0022006516498,   0.0023480529563, &
         0.0024951020347,   0.0026417768254,   0.0027880553253,   0.0029339155908, &
         0.0030793357412,   0.0032242939618,   0.0033687685073,   0.0035127377051, &
         0.0036561799581,   0.0037990737488,   0.0039413976414,   0.0040831302861, &
         0.0042242504214,   0.0043647368780,   0.0045045685814,   0.0046437245557, &
         0.0047821839259,   0.0049199259218,   0.0050569298808,   0.0051931752509, &
         0.0053286415939,   0.0054633085886,   0.0055971560337,   0.0057301638506, &
         0.0058623120869,   0.0059935809191,   0.0061239506556,   0.0062534017395, &
         0.0063819147521,   0.0065094704151,   0.0066360495938,   0.0067616333002, &
         0.0068862026954,   0.0070097390930,   0.0071322239611,   0.0072536389258, &
         0.0073739657738,   0.0074931864548,   0.0076112830845,   0.0077282379474, &
         0.0078440334989,   0.0079586523688,   0.0080720773629,   0.0081842914664, &
         0.0082952778462,   0.0084050198532,   0.0085135010250,   0.0086207050884, &
         0.0087266159617,   0.0088312177572,   0.0089344947838,   0.0090364315487, &
         0.0091370127605,   0.0092362233310,   0.0093340483776,   0.0094304732257, &
         0.0095254834106,   0.0096190646798,   0.0097112029953,   0.0098018845353, &
         0.0098910956967,   0.0099788230970,   0.0100650535763,   0.0101497741991, &
         0.0102329722565,   0.0103146352679,   0.0103947509832,   0.0104733073842, &
         0.0105502926866,   0.0106256953419,   0.0106995040390,   0.0107717077058, &
         0.0108422955111,   0.0109112568660,   0.0109785814257,   0.0110442590908, &
         0.0111082800090,   0.0111706345766,   0.0112313134396,   0.0112903074959, &
         0.0113476078955,   0.0114032060430,   0.0114570935981,   0.0115092624770, &
         0.0115597048540,   0.0116084131623,   0.0116553800949,   0.0117005986066, &
         0.0117440619141,   0.0117857634973,   0.0118256971008,   0.0118638567341, &
         0.0119002366728,   0.0119348314596,   0.0119676359049,   0.0119986450878, &
         0.0120278543566,   0.0120552593296,   0.0120808558957,   0.0121046402153, &
         0.0121266087205,   0.0121467581158,   0.0121650853785,   0.0121815877595, &
         0.0121962627831,   0.0122091082480,   0.0122201222273,   0.0122293030687, &
         0.0122366493950,   0.0122421601043,   0.0122458343697,   0.0122476716403, &
         0.0122476716403,   0.0122458343697,   0.0122421601043,   0.0122366493950, &
         0.0122293030687,   0.0122201222273,   0.0122091082480,   0.0121962627831, &
         0.0121815877595,   0.0121650853785,   0.0121467581158,   0.0121266087205, &
         0.0121046402153,   0.0120808558957,   0.0120552593296,   0.0120278543566, &
         0.0119986450878,   0.0119676359049,   0.0119348314596,   0.0119002366728, &
         0.0118638567341,   0.0118256971008,   0.0117857634973,   0.0117440619141, &
         0.0117005986066,   0.0116553800949,   0.0116084131623,   0.0115597048540, &
         0.0115092624770,   0.0114570935981,   0.0114032060430,   0.0113476078955, &
         0.0112903074959,   0.0112313134396,   0.0111706345766,   0.0111082800090, &
         0.0110442590908,   0.0109785814257,   0.0109112568660,   0.0108422955111, &
         0.0107717077058,   0.0106995040390,   0.0106256953419,   0.0105502926866, &
         0.0104733073842,   0.0103947509832,   0.0103146352679,   0.0102329722565, &
         0.0101497741991,   0.0100650535763,   0.0099788230970,   0.0098910956967, &
         0.0098018845353,   0.0097112029953,   0.0096190646798,   0.0095254834106, &
         0.0094304732257,   0.0093340483776,   0.0092362233310,   0.0091370127605, &
         0.0090364315487,   0.0089344947838,   0.0088312177572,   0.0087266159617, &
         0.0086207050884,   0.0085135010250,   0.0084050198532,   0.0082952778462, &
         0.0081842914664,   0.0080720773629,   0.0079586523688,   0.0078440334989, &
         0.0077282379474,   0.0076112830845,   0.0074931864548,   0.0073739657738, &
         0.0072536389258,   0.0071322239611,   0.0070097390930,   0.0068862026954, &
         0.0067616333002,   0.0066360495938,   0.0065094704151,   0.0063819147521, &
         0.0062534017395,   0.0061239506556,   0.0059935809191,   0.0058623120869, &
         0.0057301638506,   0.0055971560337,   0.0054633085886,   0.0053286415939, &
         0.0051931752509,   0.0050569298808,   0.0049199259218,   0.0047821839259, &
         0.0046437245557,   0.0045045685814,   0.0043647368780,   0.0042242504214, &
         0.0040831302861,   0.0039413976414,   0.0037990737488,   0.0036561799581, &
         0.0035127377051,   0.0033687685073,   0.0032242939618,   0.0030793357412, &
         0.0029339155908,   0.0027880553253,   0.0026417768254,   0.0024951020347, &
         0.0023480529563,   0.0022006516498,   0.0020529202280,   0.0019048808535, &
         0.0017565557363,   0.0016079671307,   0.0014591373333,   0.0013100886819, &
         0.0011608435576,   0.0010114243932,   0.0008618537014,   0.0007121541635, &
         0.0005623489540,   0.0004124632544,   0.0002625349443,   0.0001127890178 /

      data T340_gaussian_weights /                                                 &
         0.0000282526374,   0.0000657657317,   0.0001033319035,   0.0001408990174,   0.0001784618055,   0.0002160181780, &
         0.0002535665436,   0.0002911054303,   0.0003286334029,   0.0003661490400,   0.0004036509265,   0.0004411376502, &
         0.0004786078007,   0.0005160599690,   0.0005534927472,   0.0005909047284,   0.0006282945064,   0.0006656606762, &
         0.0007030018334,   0.0007403165749,   0.0007776034986,   0.0008148612031,   0.0008520882886,   0.0008892833561, &
         0.0009264450080,   0.0009635718478,   0.0010006624805,   0.0010377155124,   0.0010747295511,   0.0011117032058, &
         0.0011486350871,   0.0011855238074,   0.0012223679804,   0.0012591662217,   0.0012959171486,   0.0013326193802, &
         0.0013692715372,   0.0014058722424,   0.0014424201206,   0.0014789137985,   0.0015153519046,   0.0015517330699, &
         0.0015880559273,   0.0016243191118,   0.0016605212610,   0.0016966610143,   0.0017327370140,   0.0017687479042, &
         0.0018046923321,   0.0018405689467,   0.0018763764002,   0.0019121133469,   0.0019477784440,   0.0019833703514, &
         0.0020188877316,   0.0020543292501,   0.0020896935752,   0.0021249793778,   0.0021601853322,   0.0021953101155, &
         0.0022303524078,   0.0022653108924,   0.0023001842556,   0.0023349711871,   0.0023696703796,   0.0024042805295, &
         0.0024388003360,   0.0024732285022,   0.0025075637343,   0.0025418047422,   0.0025759502392,   0.0026099989423, &
         0.0026439495720,   0.0026778008527,   0.0027115515123,   0.0027452002826,   0.0027787458993,   0.0028121871017, &
         0.0028455226334,   0.0028787512417,   0.0029118716781,   0.0029448826979,   0.0029777830608,   0.0030105715305, &
         0.0030432468749,   0.0030758078663,   0.0031082532810,   0.0031405819000,   0.0031727925085,   0.0032048838961, &
         0.0032368548570,   0.0032687041898,   0.0033004306977,   0.0033320331886,   0.0033635104750,   0.0033948613741, &
         0.0034260847079,   0.0034571793030,   0.0034881439912,   0.0035189776089,   0.0035496789974,   0.0035802470031, &
         0.0036106804775,   0.0036409782769,   0.0036711392628,   0.0037011623020,   0.0037310462663,   0.0037607900328, &
         0.0037903924838,   0.0038198525070,   0.0038491689953,   0.0038783408473,   0.0039073669667,   0.0039362462628, &
         0.0039649776505,   0.0039935600502,   0.0040219923878,   0.0040502735950,   0.0040784026091,   0.0041063783731, &
         0.0041341998358,   0.0041618659518,   0.0041893756814,   0.0042167279911,   0.0042439218529,   0.0042709562451, &
         0.0042978301518,   0.0043245425632,   0.0043510924755,   0.0043774788912,   0.0044037008186,   0.0044297572726, &
         0.0044556472740,   0.0044813698499,   0.0045069240339,   0.0045323088656,   0.0045575233913,   0.0045825666634, &
         0.0046074377409,   0.0046321356894,   0.0046566595806,   0.0046810084932,   0.0047051815122,   0.0047291777292, &
         0.0047529962426,   0.0047766361574,   0.0048000965852,   0.0048233766446,   0.0048464754607,   0.0048693921657, &
         0.0048921258983,   0.0049146758043,   0.0049370410365,   0.0049592207543,   0.0049812141245,   0.0050030203205, &
         0.0050246385229,   0.0050460679195,   0.0050673077050,   0.0050883570813,   0.0051092152575,   0.0051298814497, &
         0.0051503548815,   0.0051706347835,   0.0051907203937,   0.0052106109573,   0.0052303057269,   0.0052498039626, &
         0.0052691049315,   0.0052882079086,   0.0053071121759,   0.0053258170231,   0.0053443217473,   0.0053626256533, &
         0.0053807280532,   0.0053986282668,   0.0054163256215,   0.0054338194524,   0.0054511091019,   0.0054681939206, &
         0.0054850732663,   0.0055017465049,   0.0055182130099,   0.0055344721624,   0.0055505233515,   0.0055663659741, &
         0.0055819994349,   0.0055974231464,   0.0056126365291,   0.0056276390114,   0.0056424300294,   0.0056570090274, &
         0.0056713754577,   0.0056855287802,   0.0056994684633,   0.0057131939831,   0.0057267048239,   0.0057400004779, &
         0.0057530804457,   0.0057659442357,   0.0057785913645,   0.0057910213568,   0.0058032337458,   0.0058152280723, &
         0.0058270038858,   0.0058385607438,   0.0058498982119,   0.0058610158643,   0.0058719132830,   0.0058825900587, &
         0.0058930457901,   0.0059032800844,   0.0059132925570,   0.0059230828316,   0.0059326505405,   0.0059419953240, &
         0.0059511168310,   0.0059600147188,   0.0059686886531,   0.0059771383079,   0.0059853633656,   0.0059933635173, &
         0.0060011384624,   0.0060086879085,   0.0060160115722,   0.0060231091782,   0.0060299804598,   0.0060366251588, &
         0.0060430430255,   0.0060492338187,   0.0060551973060,   0.0060609332630,   0.0060664414744,   0.0060717217331, &
         0.0060767738408,   0.0060815976075,   0.0060861928521,   0.0060905594019,   0.0060946970927,   0.0060986057691, &
         0.0061022852843,   0.0061057355000,   0.0061089562865,   0.0061119475228,   0.0061147090965,   0.0061172409038, &
         0.0061195428497,   0.0061216148475,   0.0061234568195,   0.0061250686965,   0.0061264504178,   0.0061276019315, &
         0.0061285231945,   0.0061292141720,   0.0061296748380,   0.0061299051754,   0.0061299051754,   0.0061296748380, &
         0.0061292141720,   0.0061285231945,   0.0061276019315,   0.0061264504178,   0.0061250686965,   0.0061234568195, &
         0.0061216148475,   0.0061195428497,   0.0061172409038,   0.0061147090965,   0.0061119475228,   0.0061089562865, &
         0.0061057355000,   0.0061022852843,   0.0060986057691,   0.0060946970927,   0.0060905594019,   0.0060861928521, &
         0.0060815976075,   0.0060767738408,   0.0060717217331,   0.0060664414744,   0.0060609332630,   0.0060551973060, &
         0.0060492338187,   0.0060430430255,   0.0060366251588,   0.0060299804598,   0.0060231091782,   0.0060160115722, &
         0.0060086879085,   0.0060011384624,   0.0059933635173,   0.0059853633656,   0.0059771383079,   0.0059686886531, &
         0.0059600147188,   0.0059511168310,   0.0059419953240,   0.0059326505405,   0.0059230828316,   0.0059132925570, &
         0.0059032800844,   0.0058930457901,   0.0058825900587,   0.0058719132830,   0.0058610158643,   0.0058498982119, &
         0.0058385607438,   0.0058270038858,   0.0058152280723,   0.0058032337458,   0.0057910213568,   0.0057785913645, &
         0.0057659442357,   0.0057530804457,   0.0057400004779,   0.0057267048239,   0.0057131939831,   0.0056994684633, &
         0.0056855287802,   0.0056713754577,   0.0056570090274,   0.0056424300294,   0.0056276390114,   0.0056126365291, &
         0.0055974231464,   0.0055819994349,   0.0055663659741,   0.0055505233515,   0.0055344721624,   0.0055182130099, &
         0.0055017465049,   0.0054850732663,   0.0054681939206,   0.0054511091019,   0.0054338194524,   0.0054163256215, &
         0.0053986282668,   0.0053807280532,   0.0053626256533,   0.0053443217473,   0.0053258170231,   0.0053071121759, &
         0.0052882079086,   0.0052691049315,   0.0052498039626,   0.0052303057269,   0.0052106109573,   0.0051907203937, &
         0.0051706347835,   0.0051503548815,   0.0051298814497,   0.0051092152575,   0.0050883570813,   0.0050673077050, &
         0.0050460679195,   0.0050246385229,   0.0050030203205,   0.0049812141245,   0.0049592207543,   0.0049370410365, &
         0.0049146758043,   0.0048921258983,   0.0048693921657,   0.0048464754607,   0.0048233766446,   0.0048000965852, &
         0.0047766361574,   0.0047529962426,   0.0047291777292,   0.0047051815122,   0.0046810084932,   0.0046566595806, &
         0.0046321356894,   0.0046074377409,   0.0045825666634,   0.0045575233913,   0.0045323088656,   0.0045069240339, &
         0.0044813698499,   0.0044556472740,   0.0044297572726,   0.0044037008186,   0.0043774788912,   0.0043510924755, &
         0.0043245425632,   0.0042978301518,   0.0042709562451,   0.0042439218529,   0.0042167279911,   0.0041893756814, &
         0.0041618659518,   0.0041341998358,   0.0041063783731,   0.0040784026091,   0.0040502735950,   0.0040219923878, &
         0.0039935600502,   0.0039649776505,   0.0039362462628,   0.0039073669667,   0.0038783408473,   0.0038491689953, &
         0.0038198525070,   0.0037903924838,   0.0037607900328,   0.0037310462663,   0.0037011623020,   0.0036711392628, &
         0.0036409782769,   0.0036106804775,   0.0035802470031,   0.0035496789974,   0.0035189776089,   0.0034881439912, &
         0.0034571793030,   0.0034260847079,   0.0033948613741,   0.0033635104750,   0.0033320331886,   0.0033004306977, &
         0.0032687041898,   0.0032368548570,   0.0032048838961,   0.0031727925085,   0.0031405819000,   0.0031082532810, &
         0.0030758078663,   0.0030432468749,   0.0030105715305,   0.0029777830608,   0.0029448826979,   0.0029118716781, &
         0.0028787512417,   0.0028455226334,   0.0028121871017,   0.0027787458993,   0.0027452002826,   0.0027115515123, &
         0.0026778008527,   0.0026439495720,   0.0026099989423,   0.0025759502392,   0.0025418047422,   0.0025075637343, &
         0.0024732285022,   0.0024388003360,   0.0024042805295,   0.0023696703796,   0.0023349711871,   0.0023001842556, &
         0.0022653108924,   0.0022303524078,   0.0021953101155,   0.0021601853322,   0.0021249793778,   0.0020896935752, &
         0.0020543292501,   0.0020188877316,   0.0019833703514,   0.0019477784440,   0.0019121133469,   0.0018763764002, &
         0.0018405689467,   0.0018046923321,   0.0017687479042,   0.0017327370140,   0.0016966610143,   0.0016605212610, &
         0.0016243191118,   0.0015880559273,   0.0015517330699,   0.0015153519046,   0.0014789137985,   0.0014424201206, &
         0.0014058722424,   0.0013692715372,   0.0013326193802,   0.0012959171486,   0.0012591662217,   0.0012223679804, &
         0.0011855238074,   0.0011486350871,   0.0011117032058,   0.0010747295511,   0.0010377155124,   0.0010006624805, &
         0.0009635718478,   0.0009264450080,   0.0008892833561,   0.0008520882886,   0.0008148612031,   0.0007776034986, &
         0.0007403165749,   0.0007030018334,   0.0006656606762,   0.0006282945064,   0.0005909047284,   0.0005534927472, &
         0.0005160599690,   0.0004786078007,   0.0004411376502,   0.0004036509265,   0.0003661490400,   0.0003286334029, &
         0.0002911054303,   0.0002535665436,   0.0002160181780,   0.0001784618055,   0.0001408990174,   0.0001033319035, &
         0.0000657657317,   0.0000282526374 /


contains

!=======================================================================
!  select the horizontal and vertical resolutions
!=======================================================================
   subroutine select_resolution

      implicit none
      integer :: horizontal_resolution

 10   write (*,*) 'Horizontal resolutions:'
      if (model_version.eq.1) then          ! EUL & SLD spectral
!        write (*,*) '(1) T21  / 5.625   x 5.625    grid'
!        write (*,*) '(2) T31  / 3.75    x 3.75     grid'
        write (*,*) '(3) T42  / 2.8125  x 2.8125   grid'
!        write (*,*) '(4) T63  / 1.875   x 1.875    grid'
        write (*,*) '(5) T85  / 1.40625 x 1.40625  grid'
!        write (*,*) '(6) T106 / 1.125   x 1.125    grid'
!        write (*,*) '(7) T170 / 0.70312 x 0.70312  grid'
!        write (*,*) '(8) T340 / 0.35156 x 0.35156  grid'
        write (*,*)
        write (*,*) 'Choose resolution:'
        read  (*,*) horizontal_resolution
        select case (horizontal_resolution)
        case (1)
          nlon = 64
          nlat = 32
          gaussian_latitudes => T21_gaussian_latitudes
          gaussian_weights => T21_gaussian_weights
        case (2)
          nlon = 96
          nlat = 48
          gaussian_latitudes => T31_gaussian_latitudes
          gaussian_weights => T31_gaussian_weights
        case (3)
          nlon = 128
          nlat = 64
          gaussian_latitudes => T42_gaussian_latitudes
          gaussian_weights => T42_gaussian_weights
        case (4)
          nlon = 192
          nlat = 96
          gaussian_latitudes => T63_gaussian_latitudes
          gaussian_weights => T63_gaussian_weights
        case (5)
          nlon = 256
          nlat = 128
          gaussian_latitudes => T85_gaussian_latitudes
          gaussian_weights => T85_gaussian_weights
        case (6)
          nlon = 320
          nlat = 160
          gaussian_latitudes => T106_gaussian_latitudes
          gaussian_weights => T106_gaussian_weights
        case (7)
          nlon = 512
          nlat = 256
          gaussian_latitudes => T170_gaussian_latitudes
          gaussian_weights => T170_gaussian_weights
        case (8)
          nlon = 1024
          nlat = 512
          gaussian_latitudes => T340_gaussian_latitudes
          gaussian_weights => T340_gaussian_weights
        endselect
        write (resol,'(I3.3)') (nlon+2)/3 - 1    ! spectral resolution (triangular truncation)
        if (horizontal_resolution == 8) resol = '340'
      else                                               ! FV model
        write (*,*) 'select latitude-longitude grid (FV model)'
!        write (*,*) '(1) 4 x 5 (lat x lon) grid'
!        write (*,*) '(2) 4 x 4 (lat x lon) grid'
!        write (*,*) '(3) 3 x 3.75 (lat x lon) grid'
!        write (*,*) '(4) 2.65 x 3.33 (lat x lon) grid'
!        write (*,*) '(5) 2 x 2.5 (lat x lon) grid'
!        write (*,*) '(6) 2 x 2 (lat x lon) grid'
        write (*,*) '(6) 1.9 x 2.5 (lat x lon) grid with 96x144 grid points'
!        write (*,*) '(7) 1 x 1.25 (lat x lon) grid'
!        write (*,*) '(8) 1 x 1 (lat x lon) grid'
        write (*,*) '(8) 0.9 x 1.25 (lat x lon) grid with 192x288 grid points'
!        write (*,*) '(9) 0.5 x 0.625 (lat x lon) grid'
!        write (*,*) '(10) 0.5 x 0.5 (lat x lon) grid'
        write (*,*) '(10) 0.45 x 0.625 (lat x lon) grid with 384x576 grid points'
!        write (*,*) '(11) 0.25 x 0.3125 (lat x lon) grid'
!        write (*,*) '(12) 0.25 x 0.25 (lat x lon) grid'
        write (*,*) '(12) 0.23 x 0.3125 (lat x lon) grid with 768x1152 grid points'
        write (*,*) '(13) different grid (provide your own netcdf template)'
        write (*,*) 'Choose resolution:'
        read  (*,*) horizontal_resolution
        !horizontal_resolution=10
        select case (horizontal_resolution)
        case (1)
          nlon = 72
          nlat = 46
        case (2)
          nlon = 90
          nlat = 46
        case (3)
          nlon = 96 
          nlat = 61 
        case (4)
          nlon = 108
          nlat = 69
        case (5)
          nlon = 144
          nlat = 91
        case (6)
!          nlon = 180
!          nlat = 91
          nlon = 144
          nlat = 96
        case (7)
          nlon = 288
          nlat = 181
        case (8)
!          nlon = 360
!          nlat = 181
          nlon = 288 
          nlat = 192
        case (9)
          nlon = 576
          nlat = 361
        case (10)
!          nlon = 720
!          nlat = 361
          nlon = 576
          nlat = 384
        case (11)
          nlon = 1152
          nlat = 721
        case (12)
!          nlon = 1440
!          nlat = 721
          nlon = 1152
          nlat = 768
        case (13)
  12      write (*,'(A)') '# of longitudes'
          read (*,*) nlon
          write (*,'(A)') '# of latitude (including the poles)'
          read (*,*) nlat
          write (*,'(A,f5.3,A,f5.3)') 'Chosen resolution is (lat x lon): ',&                    
                    180./real(nlat-1),'x',360./real(nlon)
          write (*,'(I4,1x,A)') nlon,                                   &
                ' grid points in the longitudinal direction'
          write (*,'(I4,1x,A)') nlat,                                   &
                ' grid points in the meridional direction'
          write (*,'(A)') 'Correct (y/n) ?'
          read (*,'(A)') correct
          if (correct.eq.'n' .or. correct.eq.'N') goto 12
        endselect
      endif

!-----------------------------------------------------------------------
!     set vertical resolution
!-----------------------------------------------------------------------

      if (choice_testcase .eq. 11 .or. choice_testcase .eq. 31 .or. choice_testcase .eq. 32) then
        write (*,*) 
        write (*,*) 'Coefficients for new resolutions will be computed according to'
        write (*,*) 'Laprise and Girard (1990) and the specific test case parameters for test 3, 6, 7, 8'
        write (*,*)
        write (*,*) 'Choose the vertical resolutions'
!        write (*,*) '(30,60,120) For Advection Tests 12 and 13'
!        write (*,*) '(60) For Advection Test 11 and Schar Mountain 21, 22'
        write (*,*) '60: For Advection Test 11'
        write (*,*) '10: For Gravity Wave Test 31'
        write (*,*) '20: For Test with heating function 32'
        write (*,*) '(30) for test 4X, 5X and 7X (NCAR CAM5 default)'
        write (*,*) '(52) for test 4X (halved NCAR CAM4 default)'
        write (*,*) '(55) HS QBO runs, 1.25km'
        write (*,*) '(60) for test 4X (halved NCAR CAM5 default)'
        write (*,*) '(67) HS QBO runs, 0.9km'
        write (*,*) '(max: 999 levels)'   
        read (*,*) nlev
        if (choice_testcase .eq. 11) then
          nlev = 60
          dz   = 200
        else if (choice_testcase .eq. 32) then
          nlev = 20
          dz = 500
        else            ! test 31
          nlev = 10
          dz   = 1000
        endif  
        write (c_level,'(I2.2)') nlev
!        write (*,*) 'Specify the vertically equidistant spacing dz in meters'
!        write (*,*) 'test 11 and 12 and 13:  200 for 60 levels'
!        write (*,*) 'test 12 and 13:         400 for 30 levels'
!        write (*,*) 'test 12 and 13:         100 for 120 levels'
!        write (*,*) 'test 21 and 22:         500 for 60 levels'
!        write (*,*) 'test 31:               1000 for 10 levels' 
!        read (*,*) dz
      else 
        write (*,*) '(30) for test 4X, 5X and 7X (NCAR CAM5 default)'
!        write (*,*) '(52) for test 4X (halved NCAR CAM4 default)'
!        write (*,*) '(55) HS QBO runs, 1.25km'
        write (*,*) '(60) for test 4X (halved NCAR CAM5 default)'
!        write (*,*) '(67) HS QBO runs, 0.9km'
        write (*,*) '(max: 999 levels)'
        read (*,*) nlev
!        nlev = 30
        write (c_level,'(I2.2)') nlev
        write (*,*) 'test 4X, 5X, 7X, HS:       value of dz irrelevant, type 1'
        dz =1 
      endif
      write (*,*) c_level,' vertical levels are used'
      
!-----------------------------------------------------------------------
!     set some resolution dependent parameters 
!-----------------------------------------------------------------------
      nslat   = nlat - 1                          ! # staggered latitudes in FV
      nlayer  = nlon*nlat                         ! # grid points per level
      nslayer = nlon*nslat                        ! # staggered grid points per level
      ntotal  = nlayer*nlev                       ! # total grid points
      nstotal = nslayer*nlev                      ! # total staggered grid points

    end subroutine select_resolution


!=======================================================================
!  initialize the horizontal and vertical grid
!=======================================================================
    subroutine initialize_grid

      implicit none      
!-----------------------------------------------------------------------
!    local variables
!-----------------------------------------------------------------------
      integer  :: i, j,                                                  &
                  jx, jy
      
      real(r8) :: T0,                                                    & ! reference temperature
                  H,                                                     & ! scale height
                  S,                                                     & ! parameter
                  N2,                                                    & ! squared Brunt-Vaisala frequency
                  gamma,                                                 & ! adiabatic lapse rate gamma = g/cp
                  p_top,                                                 & ! pressure at the model top in Pa
                  z_top,                                                 & ! height at model top in m
                  eta_top,                                               & ! eta_top = p_top/p0
                  height                                                   ! height in m

      real(r8) :: dy, dy_half,                                           & ! latitudinal spacing
                  dx, dx_half                                              ! longitudinal spacing
      
      real(r8) :: sin_lat_np,                                            &
                  cos_lat_np,                                            &
                  rotated_lat,                                           &
                  rotated_lon
      
!-----------------------------------------------------------------------
!     allocate horizontal arrays
!-----------------------------------------------------------------------
      allocate (lat(nlat),                                              &
                lon(nlon),                                              &
                weight(nlat),                                           &  
                slat(nslat),                                            &
                slon(nlon))

!-----------------------------------------------------------------------
!     allocate vertical arrays
!-----------------------------------------------------------------------
      allocate (hyam(nlev),                                             & ! coefficient a, full level
                hybm(nlev),                                             & ! coefficient b, full level
                eta (nlev),                                             &
                hyai(nlev+1),                                           & ! coefficient a, interface level
                hybi(nlev+1),                                           & ! coefficient b, interface level
                etai (nlev+1),                                          &
                lev(nlev),                                              &
                ilev(nlev+1))
      
!-----------------------------------------------------------------------
!     initialize the vertical grid
!-----------------------------------------------------------------------
      if (nlev == 20) then                                              ! 20 levels
        hyai = hyai_L20
        hybi = hybi_L20
        etai = hyai + hybi
        ilev = etai*p0*0.01_r8                                          ! pressure at the interface levels in hPa
      else if (nlev == 26) then                                              ! standard CAM3.1 26 levels
        hyai = hyai_L26
        hybi = hybi_L26
        etai = hyai + hybi
        ilev = etai*p0*0.01_r8                                          ! pressure at the interface levels in hPa
      else if (nlev == 44) then                                         ! ECMWF truncated at approx. 2 hPa
        hyai = hyai_L44
        hybi = hybi_L44
        etai = hyai + hybi
        ilev = etai*p0*0.01_r8                                          ! pressure at the interface levels in hPa      
      else if (nlev == 52) then                                         ! ECMWF truncated at approx. 2 hPa
        hyai = hyai_L52
        hybi = hybi_L52
        etai = hyai + hybi
        ilev = etai*p0*0.01_r8                                          ! pressure at the interface levels in hPa      
      else if (nlev == 55) then                                         ! ECMWF truncated at approx. 2 hPa
        hyai = hyai_L55
        hybi = hybi_L55
        etai = hyai + hybi
        ilev = etai*p0*0.01_r8                                          ! pressure at the interface levels in hPa      
      else if (nlev == 60) then                                         ! ECMWF truncated at approx. 2 hPa
        hyai = hyai_L60
        hybi = hybi_L60
        etai = hyai + hybi
        ilev = etai*p0*0.01_r8                                          ! pressure at the interface levels in hPa      
      else if (nlev == 67) then                                         ! ECMWF truncated at approx. 2 hPa
        hyai = hyai_L67
        hybi = hybi_L67
        etai = hyai + hybi
        ilev = etai*p0*0.01_r8                                          ! pressure at the interface levels in hPa      
      else

         if (choice_testcase == 200 .or.  &
             choice_testcase == 400 .or. choice_testcase == 410 .or. choice_testcase == 411 .or.  &
             choice_testcase == 412 .or. choice_testcase == 413 .or.                              &
             choice_testcase == 42 .or. choice_testcase == 43 .or. choice_testcase == 60 .or.     &
             choice_testcase == 61 .or.  choice_testcase == 70 .or. choice_testcase == 71) then
            hyai = hyai_L30
            hybi = hybi_L30
            etai = hyai + hybi
            ilev = etai*p0*0.01_r8                                          ! pressure at the interface levels in hPa      
        elseif (choice_testcase == 11) then
            hyai = hyai_L60
            hybi = hybi_L60
            etai = hyai + hybi
            ilev = etai*p0*0.01_r8                                          !  pressure at the interface levels in hPa      
        elseif (choice_testcase == 12 .or. choice_testcase == 13) then
          T0 = 300._r8                                                  ! isothermal temperature
          z_top = nlev*dz                                               ! position of the model top in m
          H = Rd*T0/g                                                   ! scale height
          p_top = p0*exp(-z_top/H)                                      ! pressure position of the model top
          eta_top = p_top/p0                                            ! eta position of the model top
                    
          do i = nlev+1, 1, -1
            height  = (nlev+1 - i)*dz                                   ! height at the interface
            ilev(i) = p0*exp(-height/H)                                 ! pressure at the interface in Pa
            etai(i) = ilev(i)/p0                                        ! eta at the interface
            ilev(i) = ilev(i)*0.01_r8                                   ! convert pressure to hPa
            hybi(i) = (etai(i) - eta_top) / (1._r8 - eta_top)           ! a coefficient at the interface levels
            hyai(i) = etai(i) - hybi(i)                                 ! b coefficient at the interface levels
          enddo
      
        else if (choice_testcase == 21 .or. choice_testcase == 22) then
          T0 = 300._r8                                                  ! isothermal temperature
          z_top = nlev*dz                                               ! position of the model top in m
          H = Rd*T0/g                                                   ! scale height
          p_top = p0*exp(-z_top/H)                                      ! pressure position of the model top
          eta_top = p_top/p0                                            ! eta position of the model top
                    
          do i = nlev+1, 1, -1
            height  = (nlev+1 - i)*dz                                   ! height at the interface
            ilev(i) = p0*exp(-height/H)                                 ! pressure at the interface in Pa
            etai(i) = ilev(i)/p0                                        ! eta at the interface
            ilev(i) = ilev(i)*0.01_r8                                   ! convert pressure to hPa
            hybi(i) = (etai(i) - eta_top) / (1._r8 - eta_top)           ! a coefficient at the interface levels
            hyai(i) = etai(i) - hybi(i)                                 ! b coefficient at the interface levels
          enddo
          
!        else if (choice_testcase == 31.or.choice_testcase .eq.32) then
        else if (choice_testcase == 31) then
          T0    = 300._r8                                               ! temperature at the surface
          z_top = nlev*dz            
             N2 = 0.0001_r8                                             ! Brunt-Vaisala frequency squared
          S = g*g/(cp*N2)                                               ! parameter
          p_top = p0 * ( (1._r8 - S/T0) + S/T0 * exp(- N2*z_top/g) )**(cp/Rd)  ! pressure position of the model top
          eta_top = p_top/p0                                            ! eta position of the model top
          
          do i = nlev+1, 1, -1
            height  = (nlev+1 - i)*dz                                   ! height at the interface
            ilev(i) = p0 * ( (1._r8 - S/T0) + S/T0 * exp(- N2*height/g) )**(cp/Rd) ! pressure at the interface in Pa
            etai(i) = ilev(i)/p0                                        ! eta at the interface
            ilev(i) = ilev(i)*0.01_r8                                   ! convert pressure to hPa
            hybi(i) = (etai(i) - eta_top) / (1._r8 - eta_top)           ! a coefficient at the interface levels
            hyai(i) = etai(i) - hybi(i)                                 ! b coefficient at the interface levels
          enddo   
          write (*,*) 'hyai:', hyai
          write (*,*) 'hybi:', hybi
       
        else
          write (*,*) 'Please implemement the computation of the hybrid coefficients'
          write (*,*) 'for ',nlev, ' model levels'
          stop
        endif
      endif
!-----------------------------------------------------------------------
!     initialize the full model levels
!-----------------------------------------------------------------------


      do i = 1, nlev
        hyam(i) = 0.5_r8 * (hyai(i+1) + hyai(i))                    ! a coefficient at full levels
        hybm(i) = 0.5_r8 * (hybi(i+1) + hybi(i))                    ! b coefficient at full levels
        eta(i)  = 0.5_r8 * (etai(i+1) + etai(i))                    ! initialize the hybrid full levels
        lev(i)  = 0.5_r8 * (ilev(i+1) + ilev(i))                    ! pressure at the full level in hPa
      enddo
      
!      write (*,*) 'hyai'
!      write (*,'(4(e21.14,'', ''))') hyai
!
!      write (*,*) 'hyam'
!      write (*,'(4(e21.14,'', ''))') hyam
!      
!      write (*,*) 'hybi'
!      write (*,'(4(e21.14,'', ''))') hybi
!
!      write (*,*) 'hybm'
!      write (*,'(4(e21.14,'', ''))') hybm
!
      write (*,*) 'lev'
      write (*,'(8(f9.5,'', ''))') lev
!
      write (*,*) 'ilev'
      write (*,'(8(f10.5,'', ''))') ilev

!-----------------------------------------------------------------------
!     initialize the horizontal grid
!-----------------------------------------------------------------------
      dx = 2.d0*pi/dble(nlon)
      
      if (model_version.eq.1) then
 !-----------------------------------------------------------------------
 !       Gaussian grid (Eulerian and semi-Lagrangian), longitudes
 !-----------------------------------------------------------------------
         do i = 1, nlon
            lon(i) = (i-1)*dx
         enddo
 !-----------------------------------------------------------------------
 !       Gaussian grid (Eulerian and semi-Lagrangian), latitudes
 !-----------------------------------------------------------------------
         do i = 1, nlat
            lat(i)    = gaussian_latitudes(i) * deg2rad          ! convert to radians
            weight(i) = gaussian_weights(i) * 0.5_r8             ! normalize
         enddo
         
      else

            
!-----------------------------------------------------------------------
!       FV Lin-Rood staggered grid, longitudinal direction (radians)
!-----------------------------------------------------------------------
         dx_half = dx*0.5
         slon(1) = 2.0*pi - dx_half
         lon (1) = 0.0
         
         do i = 2, nlon
            lon(i)  = (i-1)*dx
            slon(i) = lon(i) - dx_half
         enddo
!-----------------------------------------------------------------------
!       FV Lin-Rood staggered grid, meridional direction (radians)
!-----------------------------------------------------------------------
         dy = pi/dble(nslat)
         dy_half = dy*0.5_r8
         
         do i = 1, nslat
            lat(i)  = -pih + (i-1)*dy
            slat(i) = lat(i) + dy_half
         enddo
         lat(nlat) = -pih + (nslat)*dy

 
!-----------------------------------------------------------------------
!       Normalized integration weights (for the calculation of the mean values per level)
!-----------------------------------------------------------------------
         do i = 2, nslat
            weight(i)  = 0.5_r8*(sin(slat(i)) - sin(slat(i-1)))
         enddo

         weight(1)    = 0.5_r8*(sin(slat(1)) + 1._r8)
         weight(nlat) = weight(1)

      endif


    end subroutine initialize_grid


!-----------------------------------------------------------------------
!  print grid initialization
!-----------------------------------------------------------------------
   subroutine print_grid                 
      write (*,*)
      write (*,*) 'eta: ', eta
      write (*,*)
      write (*,*) 'weights:'
      write (*,20) weight
      write (*,*)
      write (*,*) 'sum(weight) :', sum(weight)
!      write (*,*)
!     write (*,*) 'lon (degrees):'
!     write (*,30)  lon / deg2rad
!     write (*,*)
!      if (model_version.eq.2) then
!        write (*,*) 'slon:'
!        write (*,*)  slon
!        write (*,*)
        write (*,*) 'slon (degrees):'
        write (*,30)  slon / deg2rad
!      endif
!      write (*,*)
!      write (*,*) 'lat:'
!      write (*,*)  lat
!      write (*,*)
!      write (*,*) 'lat (degrees):'
!      write (*,10)  lat / deg2rad
!      write (*,*)
!      if (model_version.eq.2) then
!       write (*,*) 'slat:'
!       write (*,*)  slat
!       write (*,*)
!        write (*,*) 'slat (degrees):'
!        write (*,20) slat / deg2rad
!       write (*,*)
!      endif
!      if (choice_testcase >= 1 .or. choice_testcase <= 3) then
!       write (*,*)
!       write (*,*) 'Rotation angle:'
!       write (*,*) 'rotated_lat (degrees):'
!       write (*,10)  rotated_lat / deg2rad
!      endif
 10 format(8(f20.15,',',1x))
! 10 format(8(f8.4,1x))
 20 format(8(e14.7,1x))
 30 format(8(f7.3,', '))
   end subroutine print_grid

!-----------------------------------------------------------------------
!  deallocate arrays
!-----------------------------------------------------------------------
   subroutine deallocate_grid
     implicit none

     deallocate (lat, lon, weight,slat, slon)
   end subroutine deallocate_grid
  
end module cam_grid
